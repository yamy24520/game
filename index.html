<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>Maiko Survival NYC üóΩ</title>
<link rel="icon" href="data:,">
<style>
  *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
  :root{
    --glass: rgba(255,255,255,.15);
    --glass-2: rgba(255,255,255,.22);
    --ink:#fff; --ink-dark:#333;
    --brand1:#667eea; --brand2:#764ba2;
    --warn:#ff6b6b; --ok:#22c55e; --gold:#ffd700;
  }
  body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Inter,system-ui,sans-serif;background:linear-gradient(135deg,var(--brand1),var(--brand2));min-height:100vh;color:var(--ink);overflow-x:hidden;touch-action:pan-y}
  .game-container{max-width:540px;margin:0 auto;padding:16px 16px 88px}
  .header{text-align:center;padding:16px 10px;animation:fadeIn .5s ease-in}
  .header h1{font-size:1.9em;margin-bottom:6px;text-shadow:2px 2px 4px rgba(0,0,0,.3)}
  .sub{opacity:.85}
  .mood-indicator{font-size:2.2em;margin:8px 0}
  .row{display:flex;align-items:center;gap:8px;justify-content:space-between}
  .stats-container{background:var(--glass);backdrop-filter:blur(10px);border-radius:16px;padding:14px;margin:12px 0;border:1px solid rgba(255,255,255,.2)}
  .stat{margin-bottom:10px}
  .stat:last-child{margin-bottom:0}
  .stat-label{display:flex;justify-content:space-between;font-weight:600;font-size:.95em;margin-bottom:6px}
  .stat-label.crit{color:var(--gold);text-shadow:0 0 8px rgba(255,215,0,.6)}
  .stat-bar{width:100%;height:16px;background:rgba(0,0,0,.28);border-radius:10px;overflow:hidden}
  .stat-fill{height:100%;border-radius:10px;transition:width .35s ease}
  .money-fill{background:linear-gradient(90deg,#ffd700,#ffed4e)}
  .energy-fill{background:linear-gradient(90deg,#4ecdc4,#44a8a0)}
  .hunger-fill{background:linear-gradient(90deg,#ff6b6b,#ee5a52)}
  .patience-fill{background:linear-gradient(90deg,#a8e6cf,#7bc9a0)}
  .yamy-fill{background:linear-gradient(90deg,#ff69b4,#ff1493)}
  .topline{display:flex;gap:10px;align-items:center;justify-content:space-between;margin:10px 0 0}
  .turns{font-size:.9em;opacity:.9}
  .turns b{font-size:1.05em}
  .day-counter{text-align:center;font-size:1.35em;font-weight:700;margin:6px 0}
  .event-card{background:rgba(255,255,255,.2);backdrop-filter:blur(8px);border-radius:16px;padding:16px;border:2px solid rgba(255,255,255,.28);box-shadow:0 8px 28px rgba(0,0,0,.1);margin-top:10px}
  .event-rare{border-color:#ffd700;box-shadow:0 0 0 2px rgba(255,215,0,.3)}
  .event-emoji{font-size:2.2em;text-align:center;margin-bottom:8px}
  .event-title{text-align:center;font-weight:800;margin-bottom:6px}
  .chip{display:inline-flex;align-items:center;gap:6px;font-size:.8em;background:rgba(0,0,0,.25);padding:4px 8px;border-radius:999px;margin:6px auto 10px}
  .event-description{text-align:center;opacity:.95;margin-bottom:12px}
  .choices{display:flex;flex-direction:column;gap:10px}
  .choice-btn{position:relative;background:rgba(255,255,255,.16);border:2px solid rgba(255,255,255,.35);border-radius:14px;padding:12px 14px;text-align:left;color:#fff;font-weight:650;cursor:pointer}
  .choice-btn[disabled]{opacity:.6;cursor:not-allowed}
  .choice-line{display:flex;align-items:center;justify-content:space-between;gap:8px}
  .effects{font-size:.85em;opacity:.9;margin-top:4px;line-height:1.25}
  .mini{font-size:.85em;opacity:.9}
  .start-screen,.game-over{text-align:center}
  .start-box{background:var(--glass);backdrop-filter:blur(10px);border-radius:16px;padding:16px;border:1px solid rgba(255,255,255,.2);margin-top:12px}
  .select{display:flex;gap:8px;justify-content:center;flex-wrap:wrap;margin-top:10px}
  .pill{padding:8px 12px;border-radius:999px;border:2px solid #ffd700;background:rgba(255,215,0,.18);cursor:pointer;font-weight:700}
  .pill.active{background:#ffd700;color:#333}
  .start-btn,.restart-btn{margin-top:14px;background:linear-gradient(135deg,#ffd700,#ff6b6b);border:none;border-radius:22px;padding:12px 28px;font-size:1.05em;color:#fff;font-weight:800;cursor:pointer}
  .bottom-nav{position:fixed;inset:auto 0 0 0;background:rgba(0,0,0,.82);backdrop-filter:blur(10px);padding:10px;display:flex;justify-content:space-around;z-index:1000}
  .nav-btn{background:rgba(255,255,255,.14);border:2px solid rgba(255,255,255,.35);border-radius:12px;padding:10px 14px;font-size:1.05em;color:#fff;cursor:pointer;position:relative}
  .badge-count{position:absolute;top:-7px;right:-7px;background:#ff6b6b;color:#fff;border-radius:999px;width:22px;height:22px;font-size:.7em;display:flex;align-items:center;justify-content:center;border:2px solid #fff;font-weight:800}
  .overlay{position:fixed;inset:0;background:rgba(0,0,0,.86);z-index:1500;display:none}
  .overlay.show{display:block;animation:fadeIn .2s}
  .overlay .panel{max-width:540px;margin:18px auto;background:#fff;color:#333;border-radius:16px;padding:22px;position:relative}
  .close-btn{position:absolute;top:10px;right:10px;background:#ff6b6b;border:none;color:#fff;border-radius:999px;width:36px;height:36px;font-size:1.1em;cursor:pointer}
  .journal-filters{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin:10px 0}
  .filter-btn{border:2px solid #667eea;background:rgba(102,126,234,.08);color:#667eea;padding:6px 10px;border-radius:999px;cursor:pointer}
  .filter-btn.active{background:#667eea;color:#fff}
  .journal-entry{background:rgba(102,126,234,.06);border-left:4px solid #667eea;padding:12px;border-radius:10px;margin-bottom:10px}
  .notification{position:fixed;top:16px;left:50%;transform:translateX(-50%);background:rgba(255,215,0,.96);color:#333;border:2px solid #ffd700;border-radius:14px;padding:10px 14px;z-index:2000;animation:slideDown .25s ease}
  .combo-indicator{position:fixed;top:90px;right:16px;background:rgba(255,107,107,.92);border:2px solid #ff6b6b;color:#fff;border-radius:12px;padding:8px 10px;font-weight:800;z-index:1200}
  .tooltip{font-size:.85em;opacity:.85;margin-top:4px;text-align:right}
  .crit-msg{margin-top:8px;font-size:.9em}
  @media (prefers-reduced-motion: reduce){
    *{animation:none !important;transition:none !important}
  }
  @keyframes fadeIn{from{opacity:0}to{opacity:1}}
  @keyframes slideDown{from{opacity:0;transform:translate(-50%,-20px)}to{opacity:1;transform:translate(-50%,0)}}
</style>
</head>
<body>
<div class="game-container">
  <!-- START -->
  <div id="startScreen" class="start-screen">
    <div class="header">
      <div style="font-size:3.2em;margin-bottom:10px">üóΩ</div>
      <h1>MAIKO SURVIVAL NYC</h1>
      <div class="sub">Version √©quilibr√©e & difficile</div>
    </div>
    <div class="start-box">
      <div><strong>Choisis la difficult√©</strong></div>
      <div class="select" id="diffSelect">
        <button class="pill" data-diff="easy">Facile</button>
        <button class="pill active" data-diff="normal">Normal</button>
        <button class="pill" data-diff="hard">Difficile</button>
      </div>
      <div style="margin-top:8px;font-size:.95em;opacity:.9">
        <div>‚Ä¢ Prix & taxes r√©elles ¬∑ faim naturelle ¬∑ fatigue progressive</div>
        <div>‚Ä¢ Rares moins ‚ÄúOP‚Äù, punition des mauvais encha√Ænements</div>
      </div>
      <button class="start-btn" id="startBtn">üöÄ D√©marrer</button>
    </div>
  </div>

  <!-- GAME -->
  <div id="gameScreen" class="hidden">
    <div class="header">
      <h1>üóΩ MAIKO √Ä NYC</h1>
      <div class="sub">Difficult√©: <span id="diffLabel">Normal</span></div>
      <div class="mood-indicator" id="moodIcon">üòä</div>
    </div>
    <div class="row topline">
      <div class="day-counter">Jour <b id="day">1</b>/5</div>
      <div class="turns">Actions restantes: <b id="turnsLeft">8</b>/8</div>
    </div>

    <div class="stats-container">
      <div class="stat">
        <div class="stat-label" id="moneyLabel"><span>üí∞ Argent</span><span><b id="money">300</b>$</span></div>
        <div class="stat-bar"><div class="stat-fill money-fill" id="moneyBar" style="width:100%"></div></div>
      </div>
      <div class="stat">
        <div class="stat-label" id="energyLabel"><span>‚ö° √ânergie</span><span><b id="energy">100</b>%</span></div>
        <div class="stat-bar"><div class="stat-fill energy-fill" id="energyBar" style="width:100%"></div></div>
      </div>
      <div class="stat">
        <div class="stat-label" id="hungerLabel"><span>üçî Faim</span><span><b id="hunger">40</b>%</span></div>
        <div class="stat-bar"><div class="stat-fill hunger-fill" id="hungerBar" style="width:40%"></div></div>
      </div>
      <div class="stat">
        <div class="stat-label" id="patienceLabel"><span>üò§ Patience</span><span><b id="patience">100</b>%</span></div>
        <div class="stat-bar"><div class="stat-fill patience-fill" id="patienceBar" style="width:100%"></div></div>
      </div>
      <div class="stat">
        <div class="stat-label" id="yamyLabel"><span>üíï Yamy</span><span><b id="yamy">100</b>%</span></div>
        <div class="stat-bar"><div class="stat-fill yamy-fill" id="yamyBar" style="width:100%"></div></div>
      </div>
      <div id="critBox" class="crit-msg"></div>
    </div>

    <div id="eventContainer"></div>
  </div>

  <!-- GAME OVER -->
  <div id="gameOverScreen" class="hidden game-over">
    <h2>üíÄ GAME OVER üíÄ</h2>
    <div id="gameOverReason" style="margin:10px 0 6px"></div>
    <div class="start-box" style="color:#333">
      <div><b>Jours:</b> <span id="finalDays">0</span></div>
      <div><b>Actions:</b> <span id="finalActions">0</span></div>
      <div><b>Argent:</b> $<span id="finalMoney">0</span></div>
      <div><b>Photos:</b> <span id="finalPhotos">0</span></div>
      <div><b>Achievements:</b> <span id="finalAchievements">0</span>/25</div>
    </div>
    <button class="restart-btn" id="restartBtn">üîÑ Recommencer</button>
  </div>

  <!-- NAV -->
  <div id="bottomNav" class="bottom-nav hidden">
    <button class="nav-btn" id="journalBtn" title="J">üìî<span class="badge-count" id="journalBadge">0</span></button>
    <button class="nav-btn" id="achievementsBtn" title="A">üèÜ<span class="badge-count" id="achievementsBadge">0</span></button>
    <button class="nav-btn" id="statsBtn" title="S">üìä</button>
    <button class="nav-btn" id="soundBtn" title="Son">üîá</button>
  </div>
</div>

<!-- Overlays -->
<div id="journalOverlay" class="overlay"><div class="panel">
  <button class="close-btn" data-close>√ó</button>
  <h2 style="color:#667eea;text-align:center">üìî Journal</h2>
  <div class="journal-filters" id="filters">
    <button class="filter-btn active" data-filter="all">Tout</button>
    <button class="filter-btn" data-filter="yamy">üíï Yamy</button>
    <button class="filter-btn" data-filter="food">üçî Bouffe</button>
    <button class="filter-btn" data-filter="photos">üì∏ Photos</button>
    <button class="filter-btn" data-filter="mood">üò§ Mood</button>
  </div>
  <div id="journalStats" style="display:grid;grid-template-columns:repeat(2,1fr);gap:8px;margin-bottom:8px;font-size:.95em"></div>
  <div id="journalEntries"></div>
</div></div>

<div id="achievementsOverlay" class="overlay"><div class="panel">
  <button class="close-btn" data-close>√ó</button>
  <h2 style="color:#667eea;text-align:center">üèÜ Achievements</h2>
  <div id="achievementsList"></div>
</div></div>

<div id="statsOverlay" class="overlay"><div class="panel">
  <button class="close-btn" data-close>√ó</button>
  <h2 style="color:#667eea;text-align:center">üìä Statistiques</h2>
  <div id="statsHistory"></div>
  <div id="spendingBreakdown" style="margin-top:12px"></div>
  <div id="generalStats" style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:12px"></div>
</div></div>

<div id="notificationContainer"></div>
<div id="comboIndicator" class="combo-indicator hidden">
  üî• COMBO <span id="comboX">x1</span>
  <div class="tooltip">Bonus positifs +5% par niveau</div>
</div>

<script>
/* ================== SETTINGS & UTILS ================== */
const TAX = 0.08875; // NYC sales tax approx
const TIP_MIN = 0.10, TIP_MAX = 0.20; // typical tips on food
const DAY_ACTIONS = 13;

const DIFFS = {
  easy:   { label:'Facile',  price:0.95, hungerTick:5, energyDaily:0, yamyWear:2, rareBuff:1.0 },
  normal: { label:'Normal',  price:1.00, hungerTick:7, energyDaily:2, yamyWear:3, rareBuff:1.0 },
  hard:   { label:'Difficile', price:1.15, hungerTick:10, energyDaily:4, yamyWear:5, rareBuff:1.15 }
};

let soundEnabled = JSON.parse(localStorage.getItem('msnyc_sound')||'false');
let selectedDiff = localStorage.getItem('msnyc_diff') || 'normal';

function clamp(v,min,max){ return Math.max(min, Math.min(max,v)); }
function vibrate(ms=50){ if('vibrate' in navigator) navigator.vibrate(ms); }
function fmt(n){ return Math.round(n); }
function showNote(icon, text){
  const n = document.createElement('div');
  n.className='notification'; n.innerHTML=`<b style="margin-right:6px">${icon}</b>${text}`;
  document.getElementById('notificationContainer').appendChild(n);
  setTimeout(()=>n.remove(), 2500);
}

/* ================== AUDIO ================== */
const sounds = {
  click: () => play(500, .08, .05),
  success: () => play(820, .12, .09),
  fail: () => play(220, .14, .1),
  achievement: () => { play(600,.08,.06); setTimeout(()=>play(820,.08,.06),100); setTimeout(()=>play(1000,.12,.08),220); }
};
function play(freq, duration, volume){
  if(!soundEnabled) return;
  try{
    const Ctx = window.AudioContext||window.webkitAudioContext;
    if(!Ctx) return;
    const ctx = new Ctx(), osc=ctx.createOscillator(), g=ctx.createGain();
    osc.connect(g); g.connect(ctx.destination);
    osc.frequency.value=freq; g.gain.value=volume;
    osc.start(); osc.stop(ctx.currentTime+duration);
  }catch(e){}
}

/* ================== STATE ================== */
const game = {
  state: { day:1, actionCount:0, money:300, energy:100, hunger:40, patience:100, yamy:100, photos:0, maxMoney:300, combo:0, lastChoiceType:null, statsHistory:[] },
  journal: [], achievements: [], usedEvents: [], availableEvents: [], currentFilter:'all',
  spending: { food:0, transport:0, culture:0, shopping:0, other:0 },
  energyStreak:0, patienceStreak:0, daySpending:0, miniGamesWon:0, walkCount:0, metroCount:0, kevinAvoidCount:0
};

/* ================== DATA (quotes / achievements / events) ================== */
const quotes = {
  hungry:["Je vais croquer un taxi l√†","Mon ventre crie au secours","J‚Äôai des √©toiles devant les yeux","Tout est nourriture autour de moi"],
  tired:["Mes jambes sont en carton","Sieste sur un trottoir ok?","J‚Äôai clign√© trop longtemps -> dodo","Je marche en pilote auto"],
  broke:["NYC m‚Äôa rackett√©e","Je vais vendre mes chaussures","Budget √©vapor√©","Note √† moi-m√™me: plus jamais"],
  impatient:["Ne me parlez pas merci","Je deviens allergique aux gens","Profs = boss de fin","Je boude activement"],
  happy:["Ok c‚Äôest styl√© de ouf","C‚Äôest exactement comme dans les films","Je kiffe cette journ√©e","Le mood est au vert"],
  photos:["Mon stockage pleure","Encore une, juste une‚Ä¶","La lumi√®re est insane","Je suis la paparazzi de moi-m√™me"],
  food:["Tout est XXL ici","Beurre + sucre + friture = üá∫üá∏","Rien ne bat un bon ramen","Je r√™ve de l√©gumes"],
  nyc:["NYC est une machine √† fatigue","Bruyant, grand, vivant","Je comprends le mythe","Clermont me manque un peu"],
  group:["Le groupe tra√Æne les pieds","On s‚Äôest quand m√™me marr√©s","Tout le monde r√¢le en ch≈ìur","Photo de groupe rat√©e x12"],
  yamy:["Yamy me manque","Spamm√© de c≈ìurs (pardon)","Une peluche pour Yamy?","Je veux lui raconter tout"],
  missYamy:["Le manque commence √† piquer","Je veux juste un c√¢lin l√†","Le d√©calage me nargue","Reviens vite pls"]
};

const achievementsList = [
  {id:'first_day', icon:'üóìÔ∏è', title:'Premier Jour', desc:'Survivre au jour 1', condition:()=>game.state.day>=2},
  {id:'survivor', icon:'üèÜ', title:'Survivor', desc:'Terminer le voyage', condition:()=>game.state.day>5},
  {id:'broke', icon:'üí∏', title:'Fauch√©e', desc:'Avoir moins de 50$', condition:()=>game.state.money<50},
  {id:'rich', icon:'üí∞', title:'√âconome', desc:'Finir avec plus de 200$', condition:()=>game.state.day>5 && game.state.money>200},
  {id:'photographer', icon:'üì∏', title:'Photographe', desc:'Prendre 50 photos', condition:()=>game.state.photos>=50},
  {id:'paparazzi', icon:'üì∑', title:'Paparazzi', desc:'Prendre 100 photos', condition:()=>game.state.photos>=100},
  {id:'foodie', icon:'üçî', title:'Foodie', desc:'Manger 10 fois', condition:()=>game.journal.filter(e=>e.category==='food').length>=10},
  {id:'starving', icon:'üòµ', title:'Affam√©e', desc:'Avoir 90%+ de faim', condition:()=>game.state.hunger>=90},
  {id:'energizer', icon:'‚ö°', title:'√ânergique', desc:'80%+ √©nergie 5 actions', condition:()=>false},
  {id:'zen', icon:'üßò', title:'Zen Master', desc:'90%+ patience un jour', condition:()=>false},
  {id:'love_birds', icon:'üíï', title:'Love Birds', desc:'Yamy 90%+ longtemps', condition:()=>game.state.yamy>=90 && game.state.actionCount>10},
  {id:'heartbroken', icon:'üíî', title:'Heartbroken', desc:'Yamy ‚â§ 20%', condition:()=>game.state.yamy<=20},
  {id:'labubu', icon:'üß∏', title:'Best GF', desc:'Acheter le Labubu', condition:()=>false},
  {id:'spender', icon:'üí≥', title:'D√©pensi√®re', desc:'300$ en un jour', condition:()=>false},
  {id:'walker', icon:'üö∂‚Äç‚ôÄÔ∏è', title:'Marcheuse', desc:'Refuser 5 transports', condition:()=>false},
  {id:'metro_master', icon:'üöá', title:'Metro Master', desc:'10 m√©tros', condition:()=>false},
  {id:'tourist', icon:'üóΩ', title:'Touriste Ultime', desc:'Spots iconiques', condition:()=>false},
  {id:'combo_master', icon:'üî•', title:'Combo Master', desc:'Combo x5', condition:()=>false},
  {id:'lucky', icon:'üçÄ', title:'Chanceuse', desc:'√âv√®nement rare', condition:()=>false},
  {id:'minigame_master', icon:'üéÆ', title:'Mini-jeu Pro', desc:'3 mini-jeux', condition:()=>false},
  {id:'photo_perfectionist', icon:'üì∏', title:'Perfectionniste Photo', desc:'Photo parfaite', condition:()=>false},
  {id:'negotiator', icon:'üí∞', title:'N√©gociatrice', desc:'N√©gociation ok', condition:()=>false},
  {id:'journal_writer', icon:'üìî', title:'√âcrivaine', desc:'30 entr√©es', condition:()=>game.journal.length>=30},
  {id:'balanced', icon:'‚öñÔ∏è', title:'√âquilibr√©e', desc:'Stats >50% en fin', condition:()=>game.state.day>5 && game.state.money>100 && game.state.energy>50 && game.state.hunger<50 && game.state.patience>50 && game.state.yamy>50},
  {id:'perfectionist', icon:'üíé', title:'Perfectionniste', desc:'Stats >70% en fin', condition:()=>game.state.day>5 && game.state.energy>70 && game.state.hunger<30 && game.state.patience>70 && game.state.yamy>70}
];

const baseEvents = [
  // === FOOD (mais version chaotique) ===
  {emoji:"üçï",title:"Pizza qui d√©gouline",desc:"Une part √âNORME. L'huile coule sur ton bras.",category:'food',
   choices:[{text:"üçï Manger quand m√™me (8$)",cost:8,effects:{hunger:-25,energy:+4}},{text:"ü§¢ C'est trop gras",effects:{hunger:+12,patience:-8}}]},
  
  {emoji:"üå≠",title:"Hot-dog de rue",desc:"Le vendeur te fixe bizarrement. C'est louche.",category:'food',
   choices:[{text:"üå≠ YOLO (5$)",cost:5,effects:{hunger:-20,patience:-4}},{text:"üèÉ‚Äç‚ôÄÔ∏è Fuir",effects:{patience:+2}}]},
  
  {emoji:"‚òï",title:"Starbucks satur√©",desc:"7 Kevin dans la file. Ton nom sera massacr√©.",category:'food',
   choices:[{text:"‚òï Risquer (7$)",cost:7,effects:{energy:+12,patience:-10}},{text:"üíß Eau gratos",effects:{patience:+4}}]},
  
  {emoji:"ü•Ø",title:"Bagel surprise",desc:"'Cream cheese' ils ont dit. C'est BEAUCOUP de cream cheese.",category:'food',
   choices:[{text:"ü•Ø Noyer dedans (6$)",cost:6,effects:{hunger:-18,patience:+6}},{text:"üßª Essuyer avant",effects:{hunger:-10}}]},
  
  {emoji:"üçú",title:"Ramen √† 18$",desc:"Pour un BOL DE SOUPE. Mais √ßa sent trop bon...",category:'food',
   choices:[{text:"üçú Craquer (18$)",cost:18,effects:{hunger:-32,patience:+14}},{text:"üí∏ Scandale!",effects:{patience:-12}}]},

  {emoji:"üßã",title:"Bubble Tea g√©ant",desc:"Taille 'Small' = 1 litre. Tu vas exploser.",category:'food',
   choices:[{text:"üßã Challenge accepted (7$)",cost:7,effects:{hunger:-8,patience:+10,energy:-4}},{text:"ü§è Partager",effects:{hunger:-4,patience:+4}}]},

  {emoji:"üçî",title:"Five Guys portions",desc:"'Regular fries' = 2 kilos de patates.",category:'food',
   choices:[{text:"üçî Menu (16$)",cost:16,effects:{hunger:-40,patience:+8,energy:-6}},{text:"üò∞ Juste burger",effects:{hunger:-20}}]},

  {emoji:"ü•§",title:"Free refills!",desc:"Distributeur de soda ILLIMIT√â. Le r√™ve am√©ricain.",category:'food',
   choices:[{text:"ü•§ Abuser x5 (0$)",effects:{energy:+16,patience:+10,hunger:-6}},{text:"üíß Eau only",effects:{patience:-4}}]},

  {emoji:"üåÆ",title:"Tacos 3am",desc:"C'est 11h du mat mais ils appellent √ßa 'late night menu'.",category:'food',
   choices:[{text:"üåÆ Weird flex (10$)",cost:10,effects:{hunger:-22,patience:+6}},{text:"‚ùå Nope",effects:{}}]},

  {emoji:"üç©",title:"Donut RAINBOW",desc:"Tellement de gla√ßage que tu vois plus la p√¢te.",category:'food',
   choices:[{text:"üç© Instagram first (5$)",cost:5,effects:{hunger:-10,photos:+6,patience:+8}},{text:"üì∏ Photo suffit",effects:{photos:+4}}]},

  {emoji:"ü•®",title:"Pretzel XXL",desc:"Gros comme ta t√™te. Sel visible √† l'≈ìil nu.",category:'food',
   choices:[{text:"ü•® Sodium blast (4$)",cost:4,effects:{hunger:-14,patience:+6}},{text:"üòµ Trop sal√©",effects:{patience:-4}}]},

  {emoji:"üç¶",title:"Ice cream 35¬∞C",desc:"Il fond PENDANT qu'on te sert.",category:'food',
   choices:[{text:"üç¶ Course contre la montre (6$)",cost:6,effects:{hunger:-8,patience:-4,energy:+4}},{text:"üèÉ Abandon",effects:{}}]},

  // === TRANSPORT (chaos urbain) ===
  {emoji:"üöá",title:"M√©tro qui PUE",desc:"Odeur non identifi√©e. Quelqu'un mange du poisson.",category:'transport',
   choices:[{text:"üöá Respirer par la bouche (3$)",cost:3,effects:{patience:-12,energy:+2}},{text:"ü§Æ Sortir!",effects:{energy:-8}}]},

  {emoji:"üöï",title:"Taxi driver furieux",desc:"Il gueule sur TOUT LE MONDE. Radio √† fond.",category:'transport',
   choices:[{text:"üöï Tenir bon (20$)",cost:20,effects:{patience:-10,energy:+6}},{text:"üö™ Descendre ici",effects:{energy:-6}}]},

  {emoji:"üö∂‚Äç‚ôÄÔ∏è",title:"Prof marche VITE",desc:"'Petit tour' = 3h de marche. Tes pieds crient.",category:'transport',
   choices:[{text:"üò´ Suivre",effects:{energy:-18,patience:-12}},{text:"üöá D√©serter (3$)",cost:3,effects:{patience:+4}}]},

  {emoji:"üõ¥",title:"Scooter √©lectrique",desc:"√áa va √† 30km/h. Tu vas mourir.",category:'transport',
   choices:[{text:"üõ¥ YOLO (8$)",cost:8,effects:{energy:+10,patience:-8}},{text:"üò∞ Trop dangereux",effects:{}}]},

  {emoji:"üö¶",title:"5 minutes au feu",desc:"Comment un feu peut √™tre rouge SI LONGTEMPS?!",category:'transport',
   choices:[{text:"üßç‚Äç‚ôÄÔ∏è Attendre...",effects:{patience:-10}},{text:"üèÉ‚Äç‚ôÄÔ∏è Traverser!",effects:{patience:+4,energy:-4}}]},

  {emoji:"üöå",title:"Bus MTA en retard",desc:"'2 minutes' = 25 minutes en temps r√©el.",category:'transport',
   choices:[{text:"üöå Optimiste (3$)",cost:3,effects:{patience:-14,energy:+2}},{text:"üëü Marcher direct",effects:{energy:-10}}]},

  // === KEVIN & GROUPE (enfer social) ===
  {emoji:"üò§",title:"Kevin fait LE MALIN",desc:"Il imite l'accent am√©ricain. Personne rit.",category:'mood',
   choices:[{text:"üò° 'La ferme Kevin'",effects:{patience:-12,energy:-6}},{text:"üôÑ Ignorer",effects:{patience:-8}}]},

  {emoji:"ü§≥",title:"Kevin PHOTOBOMBE",desc:"Il est dans TOUTES tes photos. TOUTES.",category:'photos',
   choices:[{text:"üò§ Le d√©gager",effects:{patience:-10,photos:+4}},{text:"üì± Recommencer x10",effects:{energy:-8,photos:+6}}]},

  {emoji:"üé§",title:"Prof fait des BLAGUES",desc:"'I'll be FRANK with you... my name is David!' *silence*",category:'mood',
   choices:[{text:"üòÖ Rire faux",effects:{patience:-8}},{text:"ü§ê Cringe silence",effects:{patience:-12}}]},

  {emoji:"üë•",title:"Groupe est LENT",desc:"Ils prennent 10 ans pour choisir un resto.",category:'mood',
   choices:[{text:"‚è∞ Attendre",effects:{patience:-14,energy:-4}},{text:"‚úÇÔ∏è Partir solo",effects:{patience:+6,energy:-6}}]},

  {emoji:"üì∏",title:"'UNE DERNI√àRE!'",desc:"√áa fait la 47√®me 'derni√®re' photo.",category:'photos',
   choices:[{text:"üò´ Encore une...",effects:{patience:-10,photos:+8}},{text:"‚ùå 'JE RENTRE'",effects:{patience:+4}}]},

  // === SITUATIONS ABSURDES ===
  {emoji:"üê¶",title:"Pigeon AGRESSIF",desc:"Il veut ton sandwich. Il te fixe. Il s'approche.",category:'mood',
   choices:[{text:"ü•ä D√©fendre ta bouffe",effects:{patience:-8,hunger:-10}},{text:"üèÉ‚Äç‚ôÄÔ∏è Sacrifier sandwich",effects:{patience:+4,hunger:+12}}]},

  {emoji:"üêøÔ∏è",title:"√âcureuil de Central Park",desc:"Il a ZERO peur. Il est √† 20cm de toi.",category:'photos',
   choices:[{text:"üì∏ Photo risqu√©e",effects:{photos:+10,patience:-6}},{text:"üò∞ Reculer",effects:{patience:+2}}]},

  {emoji:"üé™",title:"Times Square sensory overload",desc:"10000 √©crans. 5000 touristes. Elmo te harc√®le.",category:'mood',
   choices:[{text:"üì∏ Photo avec Elmo (20$)",cost:20,effects:{photos:+8,patience:-10}},{text:"üèÉ‚Äç‚ôÄÔ∏è FUIR",effects:{energy:-8,patience:+4}}]},

  {emoji:"üò±",title:"M&M's Store",desc:"4 √âTAGES de bonbons. Tu perds la raison.",category:'shopping',
   choices:[{text:"üõçÔ∏è Acheter (25$)",cost:25,effects:{patience:+12,yamy:+8}},{text:"üß† R√©sister",effects:{patience:-6}}]},

  {emoji:"üóΩ",title:"Queue Statue Libert√©",desc:"3h d'attente. TROIS. HEURES.",category:'mood',
   choices:[{text:"üò§ Attendre...",effects:{patience:-20,energy:-10,photos:+12}},{text:"üì∏ Photo de loin",effects:{photos:+4}}]},

  {emoji:"üßº",title:"Toilettes PAYANTES",desc:"0.25$ pour PISSER. L'Am√©rique est un mensonge.",category:'mood',
   choices:[{text:"üíµ Payer (0.25$)",cost:0.25,effects:{patience:+6}},{text:"ü§¨ Chercher ailleurs",effects:{patience:-10,energy:-6}}]},

  {emoji:"üîä",title:"New-yorkais te parle",desc:"Tu comprends 2 mots sur 10. Tu fais semblant.",category:'mood',
   choices:[{text:"üòÖ 'Yeah yeah'",effects:{patience:-6}},{text:"‚ùì 'Sorry what?'",effects:{patience:-10}}]},

  {emoji:"üéµ",title:"Subway performer",desc:"Il joue... quelque chose. C'est... du jazz? Du m√©tal?",category:'mood',
   choices:[{text:"üíµ Tip g√™n√© (2$)",cost:2,effects:{patience:+4}},{text:"üö∂‚Äç‚ôÄÔ∏è Changer de wagon",effects:{patience:-2}}]},

  {emoji:"üê±",title:"BODEGA CAT!!",desc:"LE CHAT L√âGENDAIRE. Il te regarde. C'est magique.",category:'photos',
   choices:[{text:"üì∏ 10 photos",effects:{photos:+12,patience:+14,energy:-4}},{text:"üôè Juste le regarder",effects:{patience:+10}}]},

  {emoji:"üßÄ",title:"Rat dans le m√©tro",desc:"Il mange une pizza. Il s'en fout de toi.",category:'mood',
   choices:[{text:"üì∏ PIZZA RAT (rare!)",effects:{photos:+16,patience:+8}},{text:"ü§¢ D√©gout√©e",effects:{patience:-8}}]},

  // === SHOPPING & SOUVENIRS ===
  {emoji:"üëï",title:"T-shirt 'I ‚ù§Ô∏è NY'",desc:"Le clich√© ULTIME. Mais tu le veux quand m√™me.",category:'shopping',
   choices:[{text:"üëï Assumer (15$)",cost:15,effects:{patience:+6,yamy:+4}},{text:"üòé 'Trop mainstream'",effects:{patience:-4}}]},

  {emoji:"üóΩ",title:"Mini Statue Libert√©",desc:"Made in China mais vendue √† NYC. Logique.",category:'shopping',
   choices:[{text:"üóΩ Ironique (12$)",cost:12,effects:{yamy:+6}},{text:"üí∏ Arnaque",effects:{patience:-4}}]},

  {emoji:"üß∏",title:"Labubu NYC Edition",desc:"√âDITION LIMIT√âE. Yamy va ADORER.",category:'yamy',
   choices:[{text:"üíù ACHETER (40$)",cost:40,effects:{yamy:+30,patience:+16},achievement:'labubu'},{text:"üí∏ Trop cher...",effects:{yamy:-14,patience:-10}}]},

  {emoji:"üéí",title:"Faux Supreme",desc:"Vendeur de rue: 'Real Supreme bro, trust me'",category:'shopping',
   choices:[{text:"üéí C'est une arnaque (30$)",cost:30,effects:{patience:-8}},{text:"üòè N√©gocier",effects:{patience:+4}}]},

  // === YAMY CONTENT ===
  {emoji:"üì±",title:"Yamy t'appelle",desc:"Il est 3h du mat chez lui. Il s'ennuie de toi.",category:'yamy',
   choices:[{text:"üíï Parler 30min",effects:{energy:-8,patience:+18,yamy:+20}},{text:"‚è±Ô∏è 'Je suis occup√©e'",effects:{yamy:-12,patience:-8}}]},

  {emoji:"üí¨",title:"Messages Yamy",desc:"47 messages. Il a envoy√© des memes chelous.",category:'yamy',
   choices:[{text:"üòä R√©pondre tout",effects:{energy:-6,patience:+12,yamy:+14}},{text:"üëÄ 'Vu' only",effects:{yamy:-10}}]},

  {emoji:"üéÅ",title:"Boutique kawaii",desc:"Tout est TROP MIGNON. Yamy aimerait tout.",category:'shopping',
   choices:[{text:"üõçÔ∏è Shopping spree (35$)",cost:35,effects:{yamy:+18,patience:+10}},{text:"üì∏ Photos suffisent",effects:{yamy:+4}}]},

  // === M√âT√âO & CONDITIONS ===
  {emoji:"üåßÔ∏è",title:"Pluie SOUDAINE",desc:"Pas de parapluie. Cheveux ruin√©s. Mascara coule.",category:'mood',
   choices:[{text:"‚òÇÔ∏è Acheter (15$)",cost:15,effects:{patience:+8}},{text:"üèÉ‚Äç‚ôÄÔ∏è COURIR",effects:{energy:-12,patience:-10}}]},

  {emoji:"ü•µ",title:"Chaleur INSUPPORTABLE",desc:"38¬∞C. L'asphalte ondule. Tu vas fondre.",category:'mood',
   choices:[{text:"üßä Smoothie glac√© (8$)",cost:8,effects:{energy:+10,patience:+8}},{text:"üòµ Endurer",effects:{energy:-12,patience:-10}}]},

  {emoji:"‚ùÑÔ∏è",title:"Clim ARCTIQUE",desc:"Tu passes de 38¬∞ dehors √† -5¬∞ dedans.",category:'mood',
   choices:[{text:"üß• Acheter pull (25$)",cost:25,effects:{patience:+8,energy:+6}},{text:"ü•∂ Grelotter",effects:{energy:-8}}]},

  // === FIN DE JOURN√âE ===
  {emoji:"üò¥",title:"Crash complet",desc:"Tes yeux se ferment tout seuls. Danger.",category:'energy',
   choices:[{text:"‚òï Triple shot (10$)",cost:10,effects:{energy:+20}},{text:"üòÆ‚Äçüí® Power nap 15min",effects:{energy:+12,yamy:-4}}]},

  {emoji:"ü¶∂",title:"Pieds EXPLOS√âS",desc:"22000 pas aujourd'hui. Tu marches comme un zombie.",category:'mood',
   choices:[{text:"üëü Semelles (12$)",cost:12,effects:{energy:+12,patience:+8}},{text:"üò≠ Continuer",effects:{energy:-10,patience:-8}}]},

  {emoji:"üì±",title:"Batterie 2%",desc:"Tu paniques. Comment tu vas faire tes stories??",category:'other',
   choices:[{text:"üîå Powerbank (22$)",cost:22,effects:{patience:+10}},{text:"üò∞ Mode avion",effects:{patience:-8,photos:-6}}]},

  // === CULTURE ===
  {emoji:"üé®",title:"MoMA bond√©",desc:"Plus de monde que d'≈ìuvres. Tu vois que des t√™tes.",category:'culture',
   choices:[{text:"üéüÔ∏è Billet (25$)",cost:25,effects:{patience:-12,photos:+6}},{text:"üèÉ‚Äç‚ôÄÔ∏è Boutique only",effects:{patience:+4}}]},

  {emoji:"üé≠",title:"Spectacle de rue WEIRD",desc:"Un type peint en or reste immobile. Pourquoi?",category:'culture',
   choices:[{text:"üíµ Tip (3$)",cost:3,effects:{patience:+6}},{text:"üëÄ Regarder gratos",effects:{patience:+2}}]},

  {emoji:"üìö",title:"Strand Bookstore",desc:"'18 miles of books'. Tu te perds litt√©ralement.",category:'culture',
   choices:[{text:"üìñ Acheter bouquin (15$)",cost:15,effects:{patience:+10,energy:-6}},{text:"üëÄ Fl√¢ner 30min",effects:{patience:+6,energy:-8}}]}
];

const conditionals = [
  {emoji:"üçï",title:"Pizza 99¬¢",desc:"Deal LOUCHE mais tu es BROKE.",category:'food',
   condition:()=>game.state.money<30,
   choices:[{text:"üçï YOLO (1$)",cost:1,effects:{hunger:-12,patience:-4}},{text:"üò∞ Too sketchy",effects:{hunger:+10}}]},

  {emoji:"üí§",title:"Micro-sieste urgente",desc:"Tu t'endors DEBOUT.",category:'energy',
   condition:()=>game.state.energy<30,
   choices:[{text:"üò¥ Dormir sur banc",effects:{energy:+20,hunger:+8,patience:-10}},{text:"‚òï Caf√© IV (12$)",cost:12,effects:{energy:+18}}]},

  {emoji:"üò°",title:"RAGE MODE",desc:"Kevin a fait UN TRUC DE TROP.",category:'mood',
   condition:()=>game.state.patience<30,
   choices:[{text:"ü§¨ EXPLOSER",effects:{patience:+10,energy:-10}},{text:"üßò Respiration (crash dans 5min)",effects:{patience:+4}}]},

  {emoji:"üçî",title:"Faim CRITIQUE",desc:"Ton ventre fait des bruits d'alien.",category:'food',
   condition:()=>game.state.hunger>75,
   choices:[{text:"üçî N'IMPORTE QUOI (15$)",cost:15,effects:{hunger:-35,patience:+8}},{text:"üç´ Vending machine (3$)",cost:3,effects:{hunger:-12}}]},

  {emoji:"üí∏",title:"BROKE AS HELL",desc:"Tu comptes chaque dollar. C'est la fin.",category:'money',
   condition:()=>game.state.money<20,
   choices:[{text:"üí∞ ATM (+5$ fees)",cost:-45,effects:{patience:-10}},{text:"üò≠ Survivre",effects:{patience:-8}}]},

  {emoji:"üèÉ‚Äç‚ôÄÔ∏è",title:"Retard CRITIQUE",desc:"Rdv dans 5min, t'es √† 15min.",category:'mood',
   condition:()=>game.state.patience<40,
   choices:[{text:"üöï TAXI (25$)",cost:25,effects:{energy:+8,patience:-8}},{text:"üèÉ‚Äç‚ôÄÔ∏è SPRINTER",effects:{energy:-18,patience:-12}}]},

  {emoji:"üåßÔ∏è",title:"D√©luge biblique",desc:"Il pleut des CORDES. Apocalypse.",category:'weather',
   condition:()=>game.state.energy<50,
   choices:[{text:"‚òÇÔ∏è + Pluie (18$)",cost:18,effects:{patience:+10}},{text:"üí¶ Devenir poisson",effects:{energy:-14,patience:-14}}]},

  {emoji:"üì±",title:"Batterie MORTE",desc:"0%. Pas de GPS. Pas de photos. Rien.",category:'other',
   condition:()=>game.state.photos>20,
   choices:[{text:"üîå Powerbank MAINTENANT (25$)",cost:25,effects:{patience:+12}},{text:"üò≠ Mode survie",effects:{patience:-12,photos:-10}}]},

  {emoji:"üßÉ",title:"Hypoglyc√©mie",desc:"Tu trembles. Ta vision floute. Danger.",category:'food',
   condition:()=>game.state.hunger>70 && game.state.energy<40,
   choices:[{text:"üç´ Sucre rapide (4$)",cost:4,effects:{hunger:-12,energy:+12}},{text:"ü•§ Soda (3$)",cost:3,effects:{hunger:-6,energy:+10}}]},

  {emoji:"ü¶∂",title:"Ampoule DEGUEULASSE",desc:"√áa saigne dans ta chaussure. Pas bien.",category:'mood',
   condition:()=>game.state.energy<60,
   choices:[{text:"ü©π Bandages (8$)",cost:8,effects:{energy:+10,patience:+6}},{text:"üò≠ Marcher dans la douleur",effects:{energy:-12,patience:-12}}]},

  // NOUVEAUX CONDITIONNELS
  {emoji:"üò≠",title:"Breakdown imminent",desc:"Tu vas craquer. Les larmes montent.",category:'mood',
   condition:()=>game.state.patience<25 && game.state.energy<40,
   choices:[{text:"üò≠ Pleurer 5min",effects:{patience:+14,energy:-6}},{text:"üì± Appeler Yamy",effects:{patience:+18,yamy:+20,energy:-8}}]},

  {emoji:"üçü",title:"Resto fast = survie",desc:"Tu manges n'importe quoi, n'importe o√π.",category:'food',
   condition:()=>game.state.hunger>80,
   choices:[{text:"üçü Gober 5000 calories (18$)",cost:18,effects:{hunger:-45,patience:+6,energy:-6}},{text:"üçï Pizza grasse (8$)",cost:8,effects:{hunger:-30}}]},

  {emoji:"üí≥",title:"Carte refus√©e",desc:"DECLINED. Devant tout le monde. Honte maximale.",category:'money',
   condition:()=>game.state.money<15,
   choices:[{text:"üò∞ Autre carte",effects:{patience:-16}},{text:"üíµ Fouiller poches",effects:{patience:-12,energy:-4}}]},

  {emoji:"üßä",title:"Coup de chaud critique",desc:"Vision floue. Tu vois des √©toiles.",category:'energy',
   condition:()=>game.state.energy<25,
   choices:[{text:"üßä Urgence A/C (entrer n'importe o√π)",effects:{energy:+16,patience:-6}},{text:"üíß Eau + ombre",effects:{energy:+10}}]},

  {emoji:"üí¨",title:"Yamy spam URGENT",desc:"267 messages. Il panique car tu r√©ponds pas.",category:'yamy',
   condition:()=>game.state.yamy<30,
   choices:[{text:"üíï CALL maintenant",effects:{yamy:+35,energy:-12,patience:+20}},{text:"üí¨ 'Tout va bien'",effects:{yamy:+18}}]},

  {emoji:"üì∏",title:"Storage PLEIN",desc:"'Cannot take photo'. NON. PAS MAINTENANT.",category:'photos',
   condition:()=>game.state.photos>80,
   choices:[{text:"üóëÔ∏è Delete 100 photos",effects:{photos:-20,patience:-14}},{text:"‚òÅÔ∏è Buy iCloud (3$)",cost:3,effects:{patience:+8}}]},

  {emoji:"üò¥",title:"Zombie mode",desc:"Tu marches mais tu dors en m√™me temps.",category:'energy',
   condition:()=>game.state.energy<20,
   choices:[{text:"üí§ Dormir MAINTENANT",effects:{energy:+30,hunger:+12,yamy:-8}},{text:"‚òï Caf√© + Red Bull (15$)",cost:15,effects:{energy:+25}}]},

  {emoji:"ü§Ø",title:"Surcharge sensorielle",desc:"Trop de bruit + monde + lumi√®re = HELP.",category:'mood',
   condition:()=>game.state.patience<35 && game.state.energy<50,
   choices:[{text:"üßò Panic breathing",effects:{patience:+12,energy:-4}},{text:"üèÉ‚Äç‚ôÄÔ∏è Fuir dans Central Park",effects:{patience:+16,energy:-12}}]},

  {emoji:"üí∏",title:"Dernier billet",desc:"Tu regardes ton dernier 20$. C'est √ßa ou rien.",category:'money',
   condition:()=>game.state.money<25,
   choices:[{text:"üçî Manger (20$)",cost:20,effects:{hunger:-30,patience:-10}},{text:"üí∞ Garder pour urgence",effects:{patience:-8}}]},

  {emoji:"üëü",title:"Chaussures D√âTRUITES",desc:"Semelle d√©coll√©e. Tu marches avec une tong.",category:'mood',
   condition:()=>game.state.energy<45,
   choices:[{text:"üëü Emergency shoes (60$)",cost:60,effects:{energy:+25,patience:+16}},{text:"ü©π Duct tape (5$)",cost:5,effects:{energy:+8}}]},

  {emoji:"üíî",title:"Manque de Yamy intense",desc:"Seeing couples = torture.",category:'yamy',
   condition:()=>game.state.yamy<25 && game.state.patience<50,
   choices:[{text:"üíï Long video call",effects:{yamy:+30,energy:-12,patience:+20}},{text:"üò¢ Pleurer un peu",effects:{yamy:+10,patience:-8}}]},

  {emoji:"üö´",title:"Plus d'argent liquide",desc:"Tous les stands prennent QUE du cash.",category:'money',
   condition:()=>game.state.money<10,
   choices:[{text:"üí≥ ATM emergency",cost:-50,effects:{patience:-14}},{text:"üò≠ Rien acheter",effects:{patience:-16,hunger:+10}}]},

  {emoji:"üì±",title:"R√©seau 1 barre",desc:"GPS marche pas. Maps freeze. Tu es PERDUE.",category:'other',
   condition:()=>game.state.patience<45,
   choices:[{text:"üó∫Ô∏è Demander √† 10 personnes",effects:{patience:-12,energy:-6}},{text:"üöï Taxi (20$)",cost:20,effects:{patience:+8}}]},

  {emoji:"ü•µ",title:"D√©shydratation",desc:"Bouche s√®che. T√™te qui tourne. Bois NOW.",category:'energy',
   condition:()=>game.state.energy<35,
   choices:[{text:"üíß Acheter 3 bouteilles (9$)",cost:9,effects:{energy:+18}},{text:"üö∞ Fontaine publique",effects:{energy:+10}}]},

  {emoji:"üò±",title:"Kevin perdu AGAIN",desc:"Il est pas au meeting point. ENCORE.",category:'mood',
   condition:()=>game.state.patience<55,
   choices:[{text:"üì± Appeler x10",effects:{patience:-18,energy:-6}},{text:"üö∂‚Äç‚ôÄÔ∏è Partir sans lui",effects:{patience:+10}}]}
];

const rares = [
  {emoji:"üé¨",title:"FILMING EN COURS",desc:"Tu reconnais UN ACTEUR. C'est INCROYABLE.",category:'rare',
   choices:[{text:"üì∏ Photo sneaky",effects:{photos:+20,patience:+20}},{text:"üò± Fangirl mode",effects:{patience:+18,energy:-6}}],achievement:'lucky'},

  {emoji:"üíµ",title:"100$ par terre",desc:"Un billet juste L√Ä. Personne l'a vu.",category:'rare',
   choices:[{text:"üí∞ PRENDRE",effects:{money:+100,patience:+16}},{text:"üöî Rendre √† police",effects:{patience:+12}}],achievement:'lucky'},

  {emoji:"üéüÔ∏è",title:"VIP tickets GRATUITS",desc:"Concert ce soir. Premi√®re rang√©e. WTF.",category:'rare',
   choices:[{text:"üé∂ Y ALLER",effects:{patience:+20,photos:+12,energy:-12}},{text:"üò¥ Trop fatigu√©e",effects:{energy:+10}}],achievement:'lucky'},

  {emoji:"üçï",title:"Pizza celeb",desc:"Le pizzaiolo t'offre UNE PART. 'On the house!'",category:'rare',
   choices:[{text:"üçï MERCI",effects:{hunger:-20,patience:+16}},{text:"üòä Juste merci",effects:{patience:+10}}],achievement:'lucky'},

  {emoji:"üåà",title:"Rainbow PARFAIT",desc:"Arc-en-ciel DOUBLE au-dessus de Manhattan.",category:'rare',
   choices:[{text:"üì∏ MODE PAPARAZZI",effects:{photos:+16,patience:+18}},{text:"üëÄ Juste profiter",effects:{patience:+14}}],achievement:'lucky'},

  {emoji:"üê∂",title:"Chien influenceur",desc:"C'est LE chien Instagram. 500k followers.",category:'rare',
   choices:[{text:"üì∏ Selfie avec",effects:{photos:+18,patience:+16}},{text:"üòç Le caresser",effects:{patience:+14}}],achievement:'lucky'},

  {emoji:"üéÅ",title:"√âchantillons PARTOUT",desc:"Stand qui donne des trucs gratos.",category:'rare',
   choices:[{text:"üéÅ Tout prendre",effects:{patience:+12,energy:+8}},{text:"üòä Juste un",effects:{patience:+8}}],achievement:'lucky'},

  {emoji:"üöï",title:"Uber discount",desc:"Bug de l'app. Course √† -90%.",category:'rare',
   choices:[{text:"üöï PROFITER",effects:{money:+15,patience:+14}},{text:"üëç Signaler bug",effects:{patience:+10}}],achievement:'lucky'},

  {emoji:"‚≠ê",title:"Compliment random",desc:"Quelqu'un: 'Love your outfit!' Tu brilles.",category:'rare',
   choices:[{text:"üòä MERCI",effects:{patience:+16}},{text:"ü•∞ Rougir",effects:{patience:+14}}],achievement:'lucky'},

  {emoji:"üì∏",title:"Golden hour PARFAIT",desc:"Lumi√®re INCROYABLE. Tes photos seront FEUX.",category:'rare',
   choices:[{text:"üì∏ Session 20min",effects:{photos:+20,patience:+18,energy:-8}},{text:"ü§≥ Quelques unes",effects:{photos:+12,patience:+12}}],achievement:'lucky'},

  // === ENCORE PLUS D'√âV√âNEMENTS (100+) ===
  
  // FOOD CHAOS SUITE
  {emoji:"ü•ì",title:"Bacon sur TOUT",desc:"Ils mettent du bacon PARTOUT. M√™me sur les donuts.",category:'food',
   choices:[{text:"ü•ì Bacon donut (7$)",cost:7,effects:{hunger:-16,patience:+8}},{text:"ü§¢ C'est malsain",effects:{patience:-6}}]},

  {emoji:"üå∂Ô∏è",title:"'Mild' sauce",desc:"Ils ont dit mild. Tu PLEURES. C'est de la lave.",category:'food',
   choices:[{text:"üíß Lait d'urgence (4$)",cost:4,effects:{patience:-10,energy:-4}},{text:"üò≠ Souffrir",effects:{patience:-14,hunger:+8}}]},

  {emoji:"üç™",title:"Cookie g√©ant",desc:"Taille d'une ASSIETTE. 2000 calories. YOLO.",category:'food',
   choices:[{text:"üç™ Partager (6$)",cost:6,effects:{hunger:-20,patience:+6}},{text:"üç™ Solo warrior (6$)",cost:6,effects:{hunger:-32,energy:-6}}]},

  {emoji:"ü•§",title:"Free water mais...",desc:"Le serveur te JUGE parce que tu prends pas de boisson.",category:'food',
   choices:[{text:"üíß Assumer",effects:{patience:-8}},{text:"ü•§ Commander par piti√© (3$)",cost:3,effects:{patience:+4}}]},

  {emoji:"üç≥",title:"Brunch √† 28$",desc:"Pour des ≈íUFS. Avec un avocat. L'arnaque ultime.",category:'food',
   choices:[{text:"üç≥ 'C'est tendance' (28$)",cost:28,effects:{hunger:-30,patience:-8}},{text:"üí∏ Deli sandwich (8$)",cost:8,effects:{hunger:-20,patience:+6}}]},

  {emoji:"üåΩ",title:"Ma√Øs grill√© ambulant",desc:"Un mexicain te vend du elote. √áa sent INCROYABLE.",category:'food',
   choices:[{text:"üåΩ + Mayo + fromage (6$)",cost:6,effects:{hunger:-18,patience:+10}},{text:"üö´ Trop bizarre",effects:{patience:-4}}]},

  {emoji:"ü•ü",title:"Dumpling challenge",desc:"10$ = 30 dumplings. Tu peux le faire... non?",category:'food',
   choices:[{text:"ü•ü CHALLENGE (10$)",cost:10,effects:{hunger:-40,patience:+12,energy:-8}},{text:"ü•ü Portion normale (7$)",cost:7,effects:{hunger:-18}}]},

  {emoji:"üßÉ",title:"Jus d√©tox √† 12$",desc:"'Activated charcoal'. √áa a le go√ªt de RIEN.",category:'food',
   choices:[{text:"üßÉ Influencer mode (12$)",cost:12,effects:{energy:+6,patience:-8,photos:+4}},{text:"‚òï Caf√© normal (4$)",cost:4,effects:{energy:+10}}]},

  {emoji:"üç∞",title:"Cheesecake g√©ant",desc:"La part fait 800g. C'est une BRIQUE de fromage.",category:'food',
   choices:[{text:"üç∞ To-go box (9$)",cost:9,effects:{hunger:-20,patience:+8}},{text:"üç∞ Finir ici (9$)",cost:9,effects:{hunger:-28,energy:-10}}]},

  {emoji:"üåÆ",title:"Tacos AUTHENTIQUES",desc:"Petit spot, 0 anglais parl√©, queue de locaux. C'est BON SIGNE.",category:'food',
   choices:[{text:"üåÆ 3 tacos (8$)",cost:8,effects:{hunger:-24,patience:+12}},{text:"üåÆ Menu complet (14$)",cost:14,effects:{hunger:-35,patience:+10}}]},

  {emoji:"üçø",title:"Popcorn caram√©lis√©",desc:"Stand ambulant. Odeur qui rend fou.",category:'food',
   choices:[{text:"üçø Petit sac (5$)",cost:5,effects:{hunger:-10,patience:+6}},{text:"üçø GRAND (9$)",cost:9,effects:{hunger:-18,patience:+8}}]},

  {emoji:"ü•ô",title:"Halal cart du coin",desc:"File de 15 personnes. Si y'a la queue, c'est bon.",category:'food',
   choices:[{text:"ü•ô Chicken & rice (8$)",cost:8,effects:{hunger:-24,patience:-6}},{text:"üö´ Trop long",effects:{patience:+4}}]},

  {emoji:"üçå",title:"Banana pudding hype",desc:"Magnolia Bakery. 1h de queue. Pour un DESSERT.",category:'food',
   choices:[{text:"üçå Attendre (9$)",cost:9,effects:{hunger:-16,patience:-14,photos:+6}},{text:"üò§ Pas fou",effects:{patience:+4}}]},

  {emoji:"ü•®",title:"Auntie Anne's pretzels",desc:"L'odeur dans le mall. Irr√©sistible.",category:'food',
   choices:[{text:"ü•® Original (6$)",cost:6,effects:{hunger:-14,patience:+6}},{text:"ü•® + Cheese dip (8$)",cost:8,effects:{hunger:-18,patience:+8}}]},

  {emoji:"üçï",title:"Dollar slice VRAIE",desc:"1$ la part. C'est pas bon mais c'est CHEAP.",category:'food',
   choices:[{text:"üçï 2 parts (2$)",cost:2,effects:{hunger:-20,patience:+8}},{text:"üçï 4 parts challenge (4$)",cost:4,effects:{hunger:-35,energy:-6}}]},

  // TRANSPORT ENFER
  {emoji:"üöá",title:"Showtime!",desc:"'IT'S SHOWTIME SHOWTIME!' Des gars font des flips dans le m√©tro.",category:'transport',
   choices:[{text:"üò∞ Prier pour survivre",effects:{patience:-12,energy:-4}},{text:"üì∏ Filmer (risqu√©)",effects:{photos:+8,patience:-8}}]},

  {emoji:"üö∂‚Äç‚ôÄÔ∏è",title:"Walk sign qui ment",desc:"Il dit 25 secondes. Tu as 8 secondes. COURS.",category:'transport',
   choices:[{text:"üèÉ‚Äç‚ôÄÔ∏è SPRINTEEER",effects:{energy:-10,patience:-6}},{text:"üõë Attendre encore",effects:{patience:-10}}]},

  {emoji:"üöï",title:"Taxi sent BIZARRE",desc:"Odeur non identifi√©e. Fen√™tres bloqu√©es. Aide.",category:'transport',
   choices:[{text:"ü§¢ Tenir bon",effects:{patience:-14,energy:-4}},{text:"üö™ 'ICI C'EST BON'",effects:{money:-8,energy:-6}}]},

  {emoji:"üö≤",title:"Citi Bike cass√©",desc:"Tu d√©bloques le v√©lo. La selle est PARTIE.",category:'transport',
   choices:[{text:"üö≤ Rouler debout",effects:{energy:-12,patience:-10}},{text:"üîÑ Prendre un autre",effects:{patience:-6}}]},

  {emoji:"üõ§Ô∏è",title:"M√©tro en panne",desc:"'Train traffic ahead'. Tout le monde soupire.",category:'transport',
   choices:[{text:"‚è∞ Attendre 20min",effects:{patience:-16,energy:-4}},{text:"üö∂‚Äç‚ôÄÔ∏è Sortir marcher",effects:{energy:-12}}]},

  {emoji:"üöï",title:"Taxi refuse d'aller l√†",desc:"'I don't go to Brooklyn'. Mais... pourquoi?!",category:'transport',
   choices:[{text:"üôè N√©gocier",effects:{patience:-10}},{text:"üò§ Prendre un autre (10min)",effects:{patience:-12,energy:-4}}]},

  {emoji:"üõ¥",title:"Scooter bug",desc:"Il s'arr√™te PAS de biper. Tout le monde te regarde.",category:'transport',
   choices:[{text:"üò∞ Finir le trajet",effects:{patience:-12,energy:-4}},{text:"üö´ Abandonner",effects:{money:-6,energy:-6}}]},

  {emoji:"üöå",title:"Bus qui pue l'essence",desc:"Fum√©e noire + odeur + chaleur = ENFER.",category:'transport',
   choices:[{text:"ü§¢ Respirer bouche",effects:{patience:-14}},{text:"üö™ Descendre NOW",effects:{energy:-8}}]},

  {emoji:"‚õ¥Ô∏è",title:"Ferry bond√©",desc:"Tous les touristes ont eu la m√™me id√©e. Contact physique forc√©.",category:'transport',
   choices:[{text:"‚õ¥Ô∏è Serrage maximum",effects:{patience:-10,photos:+6}},{text:"üåä Rester √† l'ext√©rieur",effects:{energy:-6,patience:+4}}]},

  {emoji:"üö¶",title:"Pi√©ton anarchie",desc:"Personne respecte les feux. C'est le chaos total.",category:'transport',
   choices:[{text:"üèÉ‚Äç‚ôÄÔ∏è Suivre le flow",effects:{energy:-6,patience:+4}},{text:"üõë √ätre la seule qui attend",effects:{patience:-10}}]},

  // KEVIN & GROUPE SUITE
  {emoji:"üì±",title:"Kevin fait le vlog",desc:"Il parle FORT dans son t√©l√©phone. Tout le monde le d√©teste.",category:'mood',
   choices:[{text:"üò° 'Arr√™te √ßa'",effects:{patience:-10,energy:-4}},{text:"üôÑ Laisser faire",effects:{patience:-12}}]},

  {emoji:"üéµ",title:"Kevin chante FAUX",desc:"Il massacre du C√©line Dion dans le m√©tro.",category:'mood',
   choices:[{text:"üéß Mettre √©couteurs",effects:{patience:-8}},{text:"üò§ 'TA GUEULE'",effects:{patience:+4,energy:-6}}]},

  {emoji:"üí¨",title:"Kevin raconte SA VIE",desc:"Personne a demand√© mais il raconte TOUT.",category:'mood',
   choices:[{text:"üòê Fake √©couter",effects:{patience:-10,energy:-4}},{text:"üì± Regarder t√©l√©phone",effects:{patience:-6}}]},

  {emoji:"ü§≥",title:"Kevin selfie ENCORE",desc:"'UNE DERNI√àRE' pour la 50√®me fois.",category:'photos',
   choices:[{text:"üò´ Poser encore",effects:{patience:-12,photos:+4}},{text:"üö∂‚Äç‚ôÄÔ∏è 'Je vous attends l√†'",effects:{patience:+6}}]},

  {emoji:"üçü",title:"Kevin pique tes frites",desc:"Sans demander. Il le fait JUSTE.",category:'food',
   choices:[{text:"üç¥ Taper sa main",effects:{patience:-8,hunger:-8}},{text:"üòí Laisser faire",effects:{patience:-12,hunger:-12}}]},

  {emoji:"üó£Ô∏è",title:"Groupe parle fran√ßais FORT",desc:"Dans le m√©tro. Tout le monde vous regarde.",category:'mood',
   choices:[{text:"ü§ê 'On peut chuchoter?'",effects:{patience:-6}},{text:"üò≥ G√™n√©e totale",effects:{patience:-10}}]},

  {emoji:"üïê",title:"Groupe EN RETARD (x3)",desc:"C'est syst√©matique. TOUJOURS 15min de retard.",category:'mood',
   choices:[{text:"‚è∞ Mentir sur l'heure +30min",effects:{patience:+6}},{text:"üò§ Attendre encore",effects:{patience:-14,energy:-6}}]},

  {emoji:"üçΩÔ∏è",title:"Groupe peut PAS choisir",desc:"30 minutes pour d√©cider o√π manger. Tu as FAIM.",category:'mood',
   choices:[{text:"üò§ 'On va L√Ä'",effects:{patience:-8,hunger:+6}},{text:"‚è∞ Attendre d√©cision",effects:{patience:-14,hunger:+10}}]},

  {emoji:"üí∏",title:"Kevin a 'oubli√©' son argent",desc:"Encore. Pour la 4√®me fois.",category:'mood',
   choices:[{text:"üí∞ Payer pour lui (12$)",cost:12,effects:{patience:-12}},{text:"üò§ 'D√©brouille-toi'",effects:{patience:-8}}]},

  {emoji:"üéí",title:"Kevin perd son sac",desc:"Panique totale. Vous devez revenir en arri√®re.",category:'mood',
   choices:[{text:"üèÉ‚Äç‚ôÄÔ∏è Aider chercher",effects:{energy:-12,patience:-14}},{text:"üò§ 'Tant pis pour toi'",effects:{patience:-8}}]},

  // SITUATIONS ABSURDES NYC
  {emoji:"üéÖ",title:"Elmo veut 40$",desc:"Pour UNE photo. Il devient agressif si tu refuses.",category:'mood',
   choices:[{text:"üì∏ Payer l'arnaque (40$)",cost:40,effects:{photos:+8,patience:-14}},{text:"üèÉ‚Äç‚ôÄÔ∏è FUIR",effects:{patience:-6}}]},

  {emoji:"üé§",title:"Pr√©dicateur apocalypse",desc:"Il crie que la fin est proche. Depuis 1987.",category:'mood',
   choices:[{text:"üëÇ √âcouter 2min",effects:{patience:-8}},{text:"üéß Ignorer",effects:{patience:-4}}]},

  {emoji:"üé∏",title:"Guitariste nul",desc:"Il joue 'Wonderwall'. Tr√®s TR√àS mal.",category:'mood',
   choices:[{text:"üíµ Tip pity (1$)",cost:1,effects:{patience:+4}},{text:"üö∂‚Äç‚ôÄÔ∏è Fuir le son",effects:{patience:+2}}]},

  {emoji:"üóûÔ∏è",title:"New York Post headline",desc:"Titre compl√®tement FOU. Tu dois le photographier.",category:'photos',
   choices:[{text:"üì∏ Screenshot",effects:{photos:+6,patience:+6}},{text:"üëÄ Juste lire",effects:{patience:+4}}]},

  {emoji:"ü¶ù",title:"Raton-laveur du parc",desc:"Il te fixe. Il s'approche. Il veut ton snack.",category:'mood',
   choices:[{text:"üç™ Lui donner",effects:{patience:+8,hunger:-6}},{text:"üèÉ‚Äç‚ôÄÔ∏è Prot√©ger ta vie",effects:{patience:-6}}]},

  {emoji:"üö®",title:"Sir√®nes NON-STOP",desc:"Ambulance + police + pompiers. Concert de sir√®nes.",category:'mood',
   choices:[{text:"üéß Volume MAX",effects:{patience:-8}},{text:"üò´ Endurer",effects:{patience:-12}}]},

  {emoji:"üöß",title:"Travaux PARTOUT",desc:"Chaque rue est en construction. Pourquoi?!",category:'transport',
   choices:[{text:"üó∫Ô∏è D√©tour infini",effects:{energy:-10,patience:-10}},{text:"ü¶∫ Passer dans le chantier",effects:{patience:-8}}]},

  {emoji:"üè¢",title:"Steam qui sort du sol",desc:"NYC classique. On dirait un film.",category:'photos',
   choices:[{text:"üì∏ Photo dramatique",effects:{photos:+8,patience:+6}},{text:"üö∂‚Äç‚ôÄÔ∏è Passer",effects:{}}]},

  {emoji:"üé≠",title:"Naked Cowboy",desc:"LE mec en sous-v√™tements avec une guitare. Iconique.",category:'culture',
   choices:[{text:"üì∏ Photo touristique (5$)",cost:5,effects:{photos:+10,patience:+8}},{text:"üëÄ Juste regarder",effects:{patience:+4}}]},

  {emoji:"üçé",title:"Big Apple symbolisme",desc:"Tu r√©alises ENFIN pourquoi ils disent 'Big Apple'... non attends, toujours pas.",category:'mood',
   choices:[{text:"ü§î R√©fl√©chir",effects:{patience:+4}},{text:"üì± Googler",effects:{patience:+2}}]},

  // SHOPPING & SOUVENIRS SUITE
  {emoji:"üóΩ",title:"Statue Liberty foam hat",desc:"Le chapeau de mousse vert. Peak tourist.",category:'shopping',
   choices:[{text:"üóΩ ASSUMER (12$)",cost:12,effects:{patience:+10,photos:+6,yamy:+6}},{text:"üòé Trop ridicule",effects:{patience:-4}}]},

  {emoji:"üíç",title:"Bijoux Canal Street",desc:"'Real gold bro'. Spoiler: c'est pas de l'or.",category:'shopping',
   choices:[{text:"üíç Fake luxury (8$)",cost:8,effects:{patience:+6}},{text:"üôÑ Arnaque √©vidente",effects:{patience:+2}}]},

  {emoji:"üé®",title:"Print d'artiste local",desc:"Petit stand dans le parc. C'est joli VRAIMENT.",category:'shopping',
   choices:[{text:"üé® Acheter (25$)",cost:25,effects:{patience:+12,yamy:+8}},{text:"üì∏ Photo only",effects:{photos:+4}}]},

  {emoji:"üëü",title:"Fake Yeezys",desc:"'Original Adidas'. Vendus dans la rue. LOL.",category:'shopping',
   choices:[{text:"üëü Pour rigoler (30$)",cost:30,effects:{patience:-8}},{text:"üòÇ 'Non merci'",effects:{patience:+4}}]},

  {emoji:"üß¢",title:"Yankees cap",desc:"Casquette NY. Tu vas la porter 1 fois.",category:'shopping',
   choices:[{text:"üß¢ Souvenir classique (28$)",cost:28,effects:{patience:+8,yamy:+4}},{text:"üí∏ Trop cher",effects:{patience:-4}}]},

  {emoji:"üõçÔ∏è",title:"Century 21",desc:"Le magasin. Les prix. Les FOULES. C'est l'apocalypse.",category:'shopping',
   choices:[{text:"üõçÔ∏è Plonger dedans",effects:{energy:-14,patience:-12,money:-35}},{text:"üò∞ Trop intense",effects:{patience:+4}}]},

  {emoji:"üìö",title:"Guidebook NYC",desc:"350 pages sur New York. Tu vas le lire... jamais.",category:'shopping',
   choices:[{text:"üìñ Acheter quand m√™me (18$)",cost:18,effects:{patience:+6}},{text:"üì± Google suffit",effects:{patience:+2}}]},

  {emoji:"üß∏",title:"FAO Schwarz",desc:"Le magasin de jouets G√âANT. Tu redeviens une enfant.",category:'shopping',
   choices:[{text:"üß∏ Peluche g√©ante (45$)",cost:45,effects:{patience:+14,yamy:+20,energy:-6}},{text:"üëÄ Juste regarder",effects:{patience:+8}}]},

  {emoji:"üéí",title:"JanSport vintage",desc:"Sac √† dos r√©tro. Tr√®s Brooklyn.",category:'shopping',
   choices:[{text:"üéí Hipster approved (35$)",cost:35,effects:{patience:+10,energy:+6}},{text:"üíº Tu as d√©j√† un sac",effects:{patience:+2}}]},

  {emoji:"üï∂Ô∏è",title:"Lunettes de soleil",desc:"Le gars vend 10 mod√®les diff√©rents. Tous √† 5$.",category:'shopping',
   choices:[{text:"üï∂Ô∏è Deal suspect (5$)",cost:5,effects:{patience:+6,energy:+2}},{text:"üëÄ Tes yeux vont bien",effects:{}}]},

  // YAMY CONTENT MAXIMUM
  {emoji:"üíï",title:"Yamy video call",desc:"Il veut te montrer son chat. Trop mignon mais long.",category:'yamy',
   choices:[{text:"üíï 30 minutes chat",effects:{energy:-10,patience:+20,yamy:+24}},{text:"‚è±Ô∏è 'Suis occup√©e'",effects:{yamy:-16,patience:-8}}]},

  {emoji:"üéÅ",title:"Cadeau parfait trouv√©",desc:"LE truc que Yamy voulait. C'est le destin.",category:'yamy',
   choices:[{text:"üéÅ ACHETER (38$)",cost:38,effects:{yamy:+28,patience:+14}},{text:"üì∏ Photo 'Regarde!'",effects:{yamy:+8}}]},

  {emoji:"üí¨",title:"Spam messages Yamy",desc:"156 messages en 2h. Il s'ennuie GRAVE.",category:'yamy',
   choices:[{text:"üíï R√©pondre √† tout",effects:{energy:-10,patience:+18,yamy:+22}},{text:"üëÄ R√©pondre vite",effects:{yamy:+6}}]},

  {emoji:"üéµ",title:"Chanson Yamy aime",desc:"Dans un magasin. C'est SA chanson.",category:'yamy',
   choices:[{text:"üéµ Envoyer Shazam",effects:{yamy:+12,patience:+8}},{text:"üé∂ Juste √©couter",effects:{patience:+4}}]},

  {emoji:"üåπ",title:"Fleurs jolies",desc:"Bouquet pour Yamy... par anticipation?",category:'yamy',
   choices:[{text:"üåπ Photos pour lui",effects:{yamy:+14,photos:+6}},{text:"üíê Acheter pour ramener (22$)",cost:22,effects:{yamy:+26,patience:+10}}]},

  {emoji:"üìç",title:"Spot Yamy parlait",desc:"Le lieu qu'il avait mentionn√©. Tu y es!",category:'yamy',
   choices:[{text:"üì∏ Photos pour lui",effects:{yamy:+16,photos:+8,patience:+10}},{text:"üí¨ Lui dire",effects:{yamy:+10}}]},

  {emoji:"‚òÅÔ∏è",title:"Couple mignon",desc:"Tu penses √† Yamy instantan√©ment. C'est mignon mais triste.",category:'yamy',
   choices:[{text:"üíï Envoyer message",effects:{yamy:+18,patience:+8}},{text:"üòî Juste soupirer",effects:{yamy:+6,patience:-4}}]},

  {emoji:"üåô",title:"Diff√©rence horaire",desc:"Il est 3h du mat chez lui mais il r√©pond. Insomniac love.",category:'yamy',
   choices:[{text:"üíï 'Va dormir!'",effects:{yamy:+14,patience:+10}},{text:"üí¨ Parler quand m√™me",effects:{yamy:+20,energy:-8}}]},

  {emoji:"üéÆ",title:"Jeu vid√©o Yamy joue",desc:"Shop qui vend le jeu. Limited edition.",category:'yamy',
   choices:[{text:"üéÆ Acheter (55$)",cost:55,effects:{yamy:+32,patience:+14}},{text:"üí∏ Trop cher",effects:{yamy:-8}}]},

  {emoji:"‚úàÔ∏è",title:"Nostalgie hit",desc:"Tu comptes les jours avant de rentrer.",category:'yamy',
   choices:[{text:"üíï Texte romantique",effects:{yamy:+20,patience:+10,energy:-4}},{text:"üòä Profiter du moment",effects:{patience:+8}}]},

  // CULTURE & ACTIVIT√âS
  {emoji:"üé®",title:"MoMA queue 2h",desc:"File INSANE. Pour voir 'Starry Night'.",category:'culture',
   choices:[{text:"‚è∞ Attendre (28$)",cost:28,effects:{patience:-18,photos:+10,energy:-8}},{text:"üèÉ‚Äç‚ôÄÔ∏è Autre mus√©e",effects:{patience:+4}}]},

  {emoji:"üóΩ",title:"Statue of Liberty stairs",desc:"354 marches. Jusqu'√† la COURONNE.",category:'culture',
   choices:[{text:"üóΩ Tout monter (23$)",cost:23,effects:{energy:-20,patience:-10,photos:+14}},{text:"üò∞ Juste la base",effects:{photos:+6}}]},

  {emoji:"üèõÔ∏è",title:"Met Museum donation",desc:"'Suggested donation'. Tu peux payer 1$... mais le regard...",category:'culture',
   choices:[{text:"üíµ Full price (30$)",cost:30,effects:{patience:+8,photos:+8}},{text:"üí∞ Minimum (5$)",cost:5,effects:{patience:-8,photos:+8}}]},

  {emoji:"üìñ",title:"Strand Books 3 √©tages",desc:"Tu te perds dans les rayons. Litt√©ralement.",category:'culture',
   choices:[{text:"üìö 2h dedans",effects:{energy:-12,patience:+14,money:-20}},{text:"üì∏ Juste l'esth√©tique",effects:{photos:+6}}]},

  {emoji:"üé≠",title:"Broadway TKTS",desc:"Billets r√©duits mais QUELLE FILE.",category:'culture',
   choices:[{text:"üéüÔ∏è Attendre (65$)",cost:65,effects:{patience:-16,energy:-10}},{text:"üí∏ Trop cher anyway",effects:{patience:-8}}]},

  {emoji:"üå≥",title:"Central Park immense",desc:"Tu marches depuis 1h. Tu es TOUJOURS dans le parc.",category:'culture',
   choices:[{text:"üö∂‚Äç‚ôÄÔ∏è Continuer",effects:{energy:-14,patience:-6,photos:+8}},{text:"üõë Pause banc",effects:{energy:+6}}]},

  {emoji:"üèÄ",title:"Basket de rue",desc:"Game intense au parc. √áa trash-talk FORT.",category:'culture',
   choices:[{text:"üì∏ Filmer",effects:{photos:+8,patience:+8}},{text:"üèÄ Demander jouer",effects:{energy:-10,patience:+12}}]},

  {emoji:"üé®",title:"Street art Bushwick",desc:"Murs ENTIERS de graffitis incroyables.",category:'culture',
   choices:[{text:"üì∏ Session 30min",effects:{photos:+14,energy:-8,patience:+12}},{text:"üö∂‚Äç‚ôÄÔ∏è Walk rapide",effects:{photos:+6}}]},

  {emoji:"üìª",title:"Radio live dans la rue",desc:"Ils font une √©mission EN DIRECT. Tu peux passer derri√®re.",category:'culture',
   choices:[{text:"üëã Faire coucou",effects:{patience:+10,photos:+6}},{text:"üò≥ Trop g√™n√©e",effects:{patience:+4}}]},

  {emoji:"üé™",title:"Performance bizarre",desc:"Art conceptuel. Personne comprend. Y compris toi.",category:'culture',
   choices:[{text:"ü§î Essayer comprendre",effects:{patience:+6,energy:-4}},{text:"üö∂‚Äç‚ôÄÔ∏è Next",effects:{patience:+2}}]},

  // PHOTOS & R√âSEAUX SOCIAUX
  {emoji:"üì±",title:"Story Instagram 24h",desc:"Tu veux TOUT partager. Spam mode ON.",category:'photos',
   choices:[{text:"üì∏ 30 stories",effects:{photos:+12,energy:-8,patience:+10}},{text:"üì± Sobre (5 stories)",effects:{photos:+6}}]},

  {emoji:"ü§≥",title:"Selfie avec skyline",desc:"L'angle est DIFFICILE. Essai #47.",category:'photos',
   choices:[{text:"ü§≥ Continuer",effects:{photos:+8,energy:-6,patience:-8}},{text:"üì∏ Demander √† quelqu'un",effects:{photos:+10,patience:+4}}]},

  {emoji:"üì∑",title:"Touriste te demande photo",desc:"'Can you take our picture?' 15 fois aujourd'hui.",category:'photos',
   choices:[{text:"üì∏ √ätre gentille",effects:{patience:+6}},{text:"üò§ 'J'ai pas le temps'",effects:{patience:-8}}]},

  {emoji:"üåÜ",title:"Blue hour parfait",desc:"Entre jour et nuit. Lumi√®re de OUF.",category:'photos',
   choices:[{text:"üì∏ Profiter 20min",effects:{photos:+16,energy:-6,patience:+12}},{text:"ü§≥ Quelques photos",effects:{photos:+8}}]},

  {emoji:"üì±",title:"Post perfect trouv√©",desc:"Carrousel de 10 photos. √áa va faire 1000 likes.",category:'photos',
   choices:[{text:"‚úçÔ∏è Caption parfait (20min)",effects:{photos:+12,energy:-8,patience:+10}},{text:"‚ö° Post rapide",effects:{photos:+8}}]},

  {emoji:"üé•",title:"Reels inspiration",desc:"Tu vois un trend. Tu DOIS le faire.",category:'photos',
   choices:[{text:"üé• Filmer 30min",effects:{photos:+14,energy:-10,patience:-8}},{text:"üíæ Save pour + tard",effects:{photos:+4}}]},

  {emoji:"üì∏",title:"Grid Instagram parfait",desc:"Les couleurs matchent. L'esth√©tique est l√†.",category:'photos',
   choices:[{text:"‚ú® Perfectionniste",effects:{photos:+10,energy:-6,patience:+8}},{text:"üì± Poster direct",effects:{photos:+6}}]},

  {emoji:"üåÖ",title:"Sunrise impossible",desc:"R√©veil 5h pour le lever de soleil. Worth it?",category:'photos',
   choices:[{text:"üì∏ Faire l'effort",effects:{photos:+18,energy:-16,patience:+12}},{text:"üò¥ Dormir > photos",effects:{energy:+10}}]},

  // M√âT√âO & CONDITIONS PHYSIQUES
  {emoji:"üí®",title:"Vent VIOLENT",desc:"Cheveux dans la bouche. Jupe qui s'envole. Chaos.",category:'mood',
   choices:[{text:"üò§ Bataille √©l√©ments",effects:{patience:-12,energy:-6}},{text:"üè¢ Refuge magasin",effects:{patience:-6}}]},

  {emoji:"‚òÄÔ∏è",title:"Soleil BRUTAL",desc:"Pas de cloud. 38¬∞C ressenti. Tu cuits.",category:'mood',
   choices:[{text:"üß¥ Cr√®me + casquette (15$)",cost:15,effects:{patience:+8,energy:+4}},{text:"ü•µ Fondre",effects:{energy:-14,patience:-12}}]},

  {emoji:"üå´Ô∏è",title:"Brume matinale",desc:"Atmosph√®re de film. Vibe myst√©rieux.",category:'photos',
   choices:[{text:"üì∏ Photos aesthetic",effects:{photos:+12,patience:+10}},{text:"üö∂‚Äç‚ôÄÔ∏è C'est flippant",effects:{patience:-4}}]},

  {emoji:"‚õàÔ∏è",title:"Orage SOUDAIN",desc:"Ciel noir en 5min. √âclairs partout.",category:'mood',
   choices:[{text:"üèÉ‚Äç‚ôÄÔ∏è Courir s'abriter",effects:{energy:-12,patience:-10}},{text:"‚òî Acheter parapluie VITE (18$)",cost:18,effects:{patience:+6}}]},

  {emoji:"üå°Ô∏è",title:"AC vs Chaleur",desc:"35¬∞ dehors, 15¬∞ dans le m√©tro. Ton corps bug.",category:'mood',
   choices:[{text:"üß• Couches multiples",effects:{patience:-8}},{text:"ü•∂ Accepter le froid",effects:{energy:-8}}]},

  // SITUATIONS PHYSIQUES
  {emoji:"üöΩ",title:"Envie URGENTE",desc:"Niveau 10/10. Panique maximale.",category:'mood',
   choices:[{text:"üèÉ‚Äç‚ôÄÔ∏è Starbucks (acheter 5$)",cost:5,effects:{patience:+10}},{text:"üò∞ Chercher WC publics",effects:{patience:-14,energy:-8}}]},

  {emoji:"ü¶∂",title:"Chaussures NEUVES erreur",desc:"Ampoules sur ampoules. Chaque pas = douleur.",category:'mood',
   choices:[{text:"üëü Nouvelles chaussures (45$)",cost:45,effects:{energy:+20,patience:+14}},{text:"üò≠ Continuer souffrir",effects:{energy:-16,patience:-16}}]},

  {emoji:"üíÜ",title:"Mal de t√™te arrive",desc:"D√©shydratation + bruit + fatigue = migraine.",category:'mood',
   choices:[{text:"üíä Medic (8$)",cost:8,effects:{patience:+12,energy:+6}},{text:"üßò Massage tempes",effects:{patience:+6}}]},

  {emoji:"üòµ",title:"Vertiges l√©gers",desc:"Tu as trop march√©. Trop chaud. Trop tout.",category:'energy',
   choices:[{text:"üßÉ Sucre rapide (5$)",cost:5,effects:{energy:+12}},{text:"ü™ë S'asseoir 10min",effects:{energy:+8,patience:-6}}]},

  {emoji:"ü•±",title:"Yeux qui piquent",desc:"Fatigue extr√™me. Tu bailles en boucle.",category:'energy',
   choices:[{text:"‚òï Triple espresso (9$)",cost:9,effects:{energy:+18,patience:-4}},{text:"üí§ Micro-sieste",effects:{energy:+10,yamy:-4}}]},

  // RANDOM & FINAL
  {emoji:"üé∞",title:"Lucky scratch card",desc:"Stand de loto. 'You feeling lucky?'",category:'other',
   choices:[{text:"üé´ Tenter (5$)",cost:5,effects:{patience:+6}},{text:"üí∏ C'est une arnaque",effects:{patience:+2}}]},

  {emoji:"ü™ô",title:"Penny press machine",desc:"Faire une pi√®ce souvenir √©cras√©e.",category:'shopping',
   choices:[{text:"ü™ô Souvenir (0.51$)",cost:0.51,effects:{patience:+8,yamy:+4}},{text:"ü§∑ Inutile",effects:{}}]},

  {emoji:"üéà",title:"Ballon gratuit",desc:"Un gars distribue des ballons. Pour... rien?",category:'mood',
   choices:[{text:"üéà Prendre",effects:{patience:+8,photos:+4}},{text:"üëã 'Non merci'",effects:{}}]},

  {emoji:"üé™",title:"Flash mob!!",desc:"Des gens commencent √† DANSER. C'est NYC baby.",category:'culture',
   choices:[{text:"üé• FILMER",effects:{photos:+12,patience:+14}},{text:"üíÉ PARTICIPER",effects:{energy:-10,patience:+16}}]},

  {emoji:"üçÉ",title:"Dollar Bill par terre",desc:"1$ sur le trottoir. Score.",category:'mood',
   choices:[{text:"üíµ Prendre",effects:{money:+1,patience:+4}},{text:"üö∂‚Äç‚ôÄÔ∏è Laisser",effects:{patience:+2}}]}
];
/* ================== PRICING (taxes & tips) ================== */
function priceWithNYC(cost, category){
  if(cost==null) return {total:0, breakdown:''};
  let base = cost;
  const diff = DIFFS[selectedDiff];
  base *= diff.price;

  let tax = base * TAX;
  let tip = 0;
  if(category==='food') tip = base * (TIP_MIN + Math.random()*(TIP_MAX-TIP_MIN));
  const total = base + tax + tip;

  return {
    total: Math.round(total*100)/100,
    breakdown: `‚âà ${base.toFixed(2)}$ + tax ${tax.toFixed(2)}${tip?` + tip ${tip.toFixed(2)}`:''}`
  };
}

/* ================== JOURNAL / ACHIEVEMENTS ================== */
function moodEmoji(){
  const s=game.state;
  const avg=(s.energy + s.patience + (100-s.hunger) + s.yamy)/4;
  if(avg<25) return 'üò≠'; if(avg<40) return 'üò´'; if(avg<60) return 'üòê'; if(avg<80) return 'üòä'; return 'üòÑ';
}
function addJournal(title,category){
  const s=game.state;
  let q="";
  if(s.yamy<40) q = pick(quotes.missYamy);
  else if(s.hunger>70) q = pick(quotes.hungry);
  else if(s.energy<30) q = pick(quotes.tired);
  else if(s.money<50) q = pick(quotes.broke);
  else if(s.patience<30) q = pick(quotes.impatient);
  else if(category==='yamy') q = pick(quotes.yamy);
  else if(category==='food') q = pick(quotes.food);
  else if(category==='photos') q = pick(quotes.photos);
  else q = Math.random()>0.5 ? pick(quotes.nyc) : pick(quotes.group);

  game.journal.unshift({
    day:s.day,action:s.actionCount,category:category||'general',
    quote:q,money:fmt(s.money),energy:fmt(s.energy),hunger:fmt(s.hunger),
    patience:fmt(s.patience),yamy:fmt(s.yamy),
    time:new Date().toLocaleTimeString('fr',{hour:'2-digit',minute:'2-digit'})
  });
  document.getElementById('journalBadge').textContent = game.journal.length;
  checkAchievements();
}
function pick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

function updateJournalUI(){
  const f = game.currentFilter;
  const list = f==='all'? game.journal : game.journal.filter(e=>e.category===f);
  const c = document.getElementById('journalEntries');
  if(!list.length){ c.innerHTML = `<div style="text-align:center;color:#888;padding:20px">Aucune entr√©e</div>`; }
  else {
    c.innerHTML = list.map(e=>`
      <div class="journal-entry">
        <div class="row" style="font-weight:700;color:#667eea"><div>Jour ${e.day} ¬∑ Act ${e.action}</div><div>${e.time}</div></div>
        <div style="margin:4px 0;opacity:.9"><span>${emojiForCat(e.category)} ${e.category}</span></div>
        <div style="font-style:italic;margin:6px 0">${e.quote}</div>
        <div style="display:grid;grid-template-columns:repeat(5,1fr);gap:6px;font-size:.85em;opacity:.85">
          <div style="text-align:center">üí∞${e.money}</div>
          <div style="text-align:center">‚ö°${e.energy}%</div>
          <div style="text-align:center">üçî${e.hunger}%</div>
          <div style="text-align:center">üò§${e.patience}%</div>
          <div style="text-align:center">üíï${e.yamy}%</div>
        </div>
      </div>`).join('');
  }
  document.getElementById('journalStats').innerHTML = `
    <div style="text-align:center;background:rgba(102,126,234,.08);padding:8px;border-radius:10px">üóìÔ∏è Jour <b>${game.state.day}</b></div>
    <div style="text-align:center;background:rgba(102,126,234,.08);padding:8px;border-radius:10px">üìù <b>${game.journal.length}</b> entr√©es</div>
    <div style="text-align:center;background:rgba(102,126,234,.08);padding:8px;border-radius:10px">üí∞ $<b>${fmt(game.state.money)}</b></div>
    <div style="text-align:center;background:rgba(102,126,234,.08);padding:8px;border-radius:10px">üì∏ <b>${game.state.photos}</b></div>`;
}
function emojiForCat(cat){ const m={yamy:'üíï',food:'üçî',photos:'üì∏',mood:'üò§',transport:'üöá',spending:'üí≥',culture:'üé®',rare:'‚≠ê',energy:'‚ö°',weather:'‚òî',social:'üë•',fun:'üéÆ',money:'üí∞'}; return m[cat]||'üìù'; }

function updateAchievementsUI(){
  const c=document.getElementById('achievementsList');
  c.innerHTML = achievementsList.map(a=>{
    const unlocked=game.achievements.includes(a.id);
    return `<div style="display:flex;gap:12px;align-items:center;padding:10px;border-left:4px solid ${unlocked?'#667eea':'#999'};background:${unlocked?'rgba(102,126,234,.06)':'rgba(0,0,0,.04)'};border-radius:10px;margin-bottom:8px;opacity:${unlocked?1:.5}">
      <div style="font-size:2em">${a.icon}</div>
      <div><div style="font-weight:800;color:#667eea">${a.title}</div><div style="opacity:.85">${a.desc}</div></div>
    </div>`;
  }).join('');
  document.getElementById('achievementsBadge').textContent = game.achievements.length;
}

function checkAchievements(){
  achievementsList.forEach(a=>{
    if(!game.achievements.includes(a.id) && a.condition && a.condition()){
      game.achievements.push(a.id);
      showNote('üèÖ',`Achievement: ${a.title}`); sounds.achievement();
    }
  });
  updateAchievementsUI();
}

/* ================== EVENTS FLOW ================== */
function buildPool(){
  const pool = [];
  // base
  pool.push(...baseEvents);
  // conditional
  pool.push(...conditionals.filter(e=>!e.condition || e.condition()));
  // rares (faible proba)
  if(Math.random()<0.05){ // 5%
    const diff = DIFFS[selectedDiff];
    const r = pick(rares);
    if(diff.rareBuff>1 && r.choices[0].effects.patience) {
      // rendre moins "OP": on applique un petit malus sur positif si hard
      r.choices = r.choices.map(ch=>{
        const ef={...ch.effects};
        if(ef.patience) ef.patience = Math.round(ef.patience / diff.rareBuff);
        if(ef.money>0)  ef.money   = Math.round(ef.money   / diff.rareBuff);
        return {...ch, effects:ef};
      });
    }
    pool.push({...r, rare:true});
  }
  return pool;
}

function showEvent(){
  const list = buildPool();
  const e = pick(list);
  const rareClass = e.rare ? ' event-rare' : '';
  const catChip = `<div class="chip">${emojiForCat(e.category)} ${e.category}</div>`;
  const cont = document.getElementById('eventContainer');

  // Inject price previews with tax/tip
  const choicesHtml = e.choices.map((ch,i)=>{
    let effectsText = [];
    // dynamic pricing
    let priceLine = '';
    if('cost' in ch){
      const p = priceWithNYC(Math.abs(ch.cost), e.category);
      const total = ch.cost>=0 ? p.total : -p.total; // ATM ‚Äúgain‚Äù
      priceLine = ch.cost>=0 ? ` ¬∑ <span>co√ªt r√©el ‚âà ${total.toFixed(2)}$</span>` : ` ¬∑ <span>gain net ‚âà ${(-total).toFixed(2)}$</span>`;
      ch._priced = total; // cache
    }
    const ef = ch.effects||{};
    if(ef.energy) effectsText.push(`‚ö°${ef.energy>0?'+':''}${ef.energy}%`);
    if(ef.hunger) effectsText.push(`üçî${ef.hunger>0?'+':''}${ef.hunger}%`);
    if(ef.patience) effectsText.push(`üò§${ef.patience>0?'+':''}${ef.patience}%`);
    if(ef.yamy) effectsText.push(`üíï${ef.yamy>0?'+':''}${ef.yamy}%`);
    if(ef.photos) effectsText.push(`üì∏+${ef.photos}`);

    return `<button class="choice-btn" data-idx="${i}">
      <div class="choice-line"><div>${ch.text}</div><div class="mini">${priceLine}</div></div>
      <div class="effects">${effectsText.join(' ¬∑ ') || '‚Äî'}</div>
    </button>`;
  }).join('');

  cont.innerHTML = `
    <div class="event-card${rareClass}">
      <div class="event-emoji">${e.emoji}</div>
      <div class="event-title">${e.title}</div>
      ${catChip}
      <div class="event-description">${e.desc}</div>
      <div class="choices" id="choices">${choicesHtml}</div>
    </div>`;

  const btns = [...document.querySelectorAll('.choice-btn')];
  btns.forEach(b=>b.addEventListener('click', ()=>{
    btns.forEach(x=>x.disabled=true); // anti double clic
    sounds.click();
    const idx = +b.dataset.idx;
    resolveChoice(e, e.choices[idx]);
  }));

  // Keyboard shortcuts
  window.onkeydown = (ev)=>{
    if(ev.key==='1' && btns[0]) btns[0].click();
    if(ev.key==='2' && btns[1]) btns[1].click();
    if(ev.key.toLowerCase()==='j') toggleOverlay('journalOverlay', true);
    if(ev.key.toLowerCase()==='a') toggleOverlay('achievementsOverlay', true);
    if(ev.key.toLowerCase()==='s') toggleOverlay('statsOverlay', true);
  };
}

function resolveChoice(evt, ch){
  const s=game.state;
  // Combo
  if(s.lastChoiceType===evt.category){
    s.combo++;
    document.getElementById('comboIndicator').classList.remove('hidden');
    document.getElementById('comboX').textContent = `x${s.combo}`;
    if(s.combo===5 && !game.achievements.includes('combo_master')){
      game.achievements.push('combo_master'); showNote('üî•','Achievement: Combo Master'); sounds.achievement();
    }
  } else {
    s.combo=1; document.getElementById('comboIndicator').classList.add('hidden');
  }
  s.lastChoiceType=evt.category;
  const comboBonus = s.combo>=2 ? 1 + (s.combo*0.05) : 1;
  const apply = v => v ? Math.round(v * (v>0? comboBonus:1)) : 0;

  // MONEY (with taxes)
  if('_priced' in ch){
    const delta = ch._priced; // already signed
    s.money -= delta; // cost positive decreases money; ATM negative increases
    // spending buckets
    if(delta>0){
      const amount = delta;
      if(evt.category==='food') game.spending.food+=amount;
      else if(evt.category==='transport') game.spending.transport+=amount;
      else if(evt.category==='culture') game.spending.culture+=amount;
      else if(evt.category==='spending') game.spending.shopping+=amount;
      else game.spending.other+=amount;
      game.daySpending += amount;
      if(game.daySpending>=300 && !game.achievements.includes('spender')){
        game.achievements.push('spender'); showNote('üí≥','Achievement: D√©pensi√®re'); sounds.achievement();
      }
    }
  }

  // APPLY EFFECTS
  const ef=ch.effects||{};
  s.energy   += apply(ef.energy||0);
  s.hunger   += apply(ef.hunger||0);
  s.patience += apply(ef.patience||0);
  s.yamy     += apply((ef.yamy||0) - DIFFS[selectedDiff].yamyWear); // usure relationnelle
  s.photos   += (ef.photos||0);

  // Fatigue passive par jour
  s.energy -= DIFFS[selectedDiff].energyDaily;

  // Faim naturelle
  if(s.actionCount%2===0) s.hunger += DIFFS[selectedDiff].hungerTick;

  // Bornes
  s.money = Math.max(0, s.money);
  s.energy = clamp(s.energy,0,100);
  s.hunger = clamp(s.hunger,0,100);
  s.patience = clamp(s.patience,0,100);
  s.yamy = clamp(s.yamy,0,100);

  // Trackers
  if((evt.title.includes('Marche')||evt.title.includes('pied')) && ch.text.includes('Marcher')){
    game.walkCount++; if(game.walkCount>=5 && !game.achievements.includes('walker')){ game.achievements.push('walker'); showNote('üö∂‚Äç‚ôÄÔ∏è','Achievement: Marcheuse'); sounds.achievement(); }
  }
  if((evt.title.includes('M√©tro')||evt.category==='transport') && ch.text.includes('M√©tro')){
    game.metroCount++; if(game.metroCount>=10 && !game.achievements.includes('metro_master')){ game.achievements.push('metro_master'); showNote('üöá','Achievement: Metro Master'); sounds.achievement(); }
  }

  // Achievement direct attach√© au choix
  if(ch.achievement && !game.achievements.includes(ch.achievement)){
    game.achievements.push(ch.achievement);
    const a = achievementsList.find(x=>x.id===ch.achievement);
    if(a){ showNote(a.icon,`Achievement: ${a.title}`); sounds.achievement(); }
  }

  s.actionCount++;
  s.statsHistory.push({ action:s.actionCount, money:s.money, energy:s.energy, hunger:s.hunger, patience:s.patience, yamy:s.yamy });

  addJournal(evt.title, evt.category);
  renderState();

  if(checkGameOver()) return;

  // Changement de jour
  if(s.actionCount % DAY_ACTIONS === 0){
    s.day++;
    if(s.day>5){ victory(); return; }
    showNote('üóìÔ∏è',`Jour ${s.day} ‚Äî difficult√© cumul√©e`);
    game.daySpending=0; game.patienceStreak=0;
  }
  setTimeout(showEvent, 500);
}

/* ================== RENDER ================== */
function renderState(){
  const s=game.state;
  const turnsLeft = DAY_ACTIONS - (s.actionCount % DAY_ACTIONS || DAY_ACTIONS);
  document.getElementById('turnsLeft').textContent = turnsLeft;

  document.getElementById('day').textContent = s.day;
  document.getElementById('money').textContent = fmt(s.money);
  document.getElementById('energy').textContent = fmt(s.energy);
  document.getElementById('hunger').textContent = fmt(s.hunger);
  document.getElementById('patience').textContent = fmt(s.patience);
  document.getElementById('yamy').textContent = fmt(s.yamy);
  document.getElementById('moodIcon').textContent = moodEmoji();

  document.getElementById('moneyBar').style.width = (s.maxMoney? Math.min(100,(s.money/s.maxMoney)*100) : 100)+'%';
  document.getElementById('energyBar').style.width = s.energy+'%';
  document.getElementById('hungerBar').style.width = s.hunger+'%';
  document.getElementById('patienceBar').style.width = s.patience+'%';
  document.getElementById('yamyBar').style.width = s.yamy+'%';

  // Critiques
  const crits=[];
  if(s.money<50) crits.push('üí∏ Budget critique');
  if(s.energy<30) crits.push('üò¥ √ânergie basse');
  if(s.hunger>70) crits.push('üçî Faim √©lev√©e');
  if(s.patience<30) crits.push('üò° Patience faible');
  if(s.yamy<30) crits.push('üíî Manque de Yamy');
  document.getElementById('critBox').innerHTML = crits.length ? `<div class="row" style="color:#ffd700">${crits.join(' ¬∑ ')}</div>` : '';

  toggleCrit('moneyLabel', s.money>=50);
  toggleCrit('energyLabel', s.energy>=30);
  toggleCrit('hungerLabel', s.hunger<=70);
  toggleCrit('patienceLabel', s.patience>=30);
  toggleCrit('yamyLabel', s.yamy>=30);
}
function toggleCrit(id, ok){
  const el=document.getElementById(id);
  if(!el) return;
  el.classList.toggle('crit', !ok);
}

/* ================== OVERLAYS & NAV ================== */
function toggleOverlay(id, forceShow){
  const ov = document.getElementById(id);
  const show = forceShow ?? !ov.classList.contains('show');
  if(show){
    ov.classList.add('show');
    if(id==='journalOverlay') updateJournalUI();
    if(id==='achievementsOverlay') updateAchievementsUI();
    if(id==='statsOverlay') updateStatsOverlay();
    // click outside to close
    ov.onclick = (e)=>{ if(e.target===ov) ov.classList.remove('show'); };
  } else ov.classList.remove('show');
}
function updateStatsOverlay(){
  const h = game.state.statsHistory.slice(-24);
  document.getElementById('statsHistory').innerHTML = `
    <div style="background:rgba(102,126,234,.08);padding:10px;border-radius:10px">
      <div style="display:grid;grid-template-columns:repeat(5,1fr);gap:8px;font-weight:800;text-align:center">
        <div>üí∞</div><div>‚ö°</div><div>üçî</div><div>üò§</div><div>üíï</div>
      </div>
      ${h.map(x=>`
        <div style="display:grid;grid-template-columns:repeat(5,1fr);gap:8px;text-align:center;border-top:1px solid rgba(0,0,0,.08);padding:4px 0">
          <div>${fmt(x.money)}</div><div>${fmt(x.energy)}</div><div>${fmt(x.hunger)}</div><div>${fmt(x.patience)}</div><div>${fmt(x.yamy)}</div>
        </div>`).join('')}
    </div>`;
  const total = Object.values(game.spending).reduce((a,b)=>a+b,0);
  const cat = {food:'üçî Nourriture',transport:'üöá Transport',culture:'üé® Culture',shopping:'üõçÔ∏è Shopping',other:'üì¶ Autre'};
  document.getElementById('spendingBreakdown').innerHTML = `
    <div style="background:rgba(102,126,234,.08);padding:10px;border-radius:10px">
    ${Object.entries(game.spending).map(([k,v])=>{
      const p = total? Math.round(v/total*100):0;
      return `<div style="margin:6px 0">
        <div class="row"><span>${cat[k]}</span><span><b>${fmt(v)}</b> (${p}%)</span></div>
        <div style="height:10px;background:rgba(0,0,0,.15);border-radius:8px;overflow:hidden"><div style="height:100%;width:${p}%;background:#667eea"></div></div>
      </div>`;
    }).join('')}
    <div style="text-align:center;margin-top:8px;font-weight:800">Total: ${fmt(total)}$</div>
    </div>`;
  document.getElementById('generalStats').innerHTML = `
    <div style="background:rgba(102,126,234,.08);padding:12px;border-radius:10px;text-align:center"><div style="font-size:1.3em;font-weight:800;color:#667eea">${game.state.actionCount}</div><div>Actions</div></div>
    <div style="background:rgba(102,126,234,.08);padding:12px;border-radius:10px;text-align:center"><div style="font-size:1.3em;font-weight:800;color:#667eea">${game.state.photos}</div><div>Photos</div></div>
    <div style="background:rgba(102,126,234,.08);padding:12px;border-radius:10px;text-align:center"><div style="font-size:1.3em;font-weight:800;color:#667eea">${game.journal.length}</div><div>Journal</div></div>
    <div style="background:rgba(102,126,234,.08);padding:12px;border-radius:10px;text-align:center"><div style="font-size:1.3em;font-weight:800;color:#667eea">${game.achievements.length}/25</div><div>Achievements</div></div>`;
}

/* ================== GAME LIFECYCLE ================== */
function startGame(){
  sounds.click();
  // init difficulty
  document.getElementById('diffLabel').textContent = DIFFS[selectedDiff].label;

  document.getElementById('startScreen').classList.add('hidden');
  document.getElementById('gameScreen').classList.remove('hidden');
  document.getElementById('bottomNav').classList.remove('hidden');

  Object.assign(game.state, { day:1, actionCount:0, money:300, energy:100, hunger:40, patience:100, yamy:100, photos:0, maxMoney:300, combo:0, lastChoiceType:null, statsHistory:[] });
  game.journal=[]; game.achievements=[]; game.usedEvents=[]; game.currentFilter='all';
  game.spending={ food:0, transport:0, culture:0, shopping:0, other:0 };
  game.energyStreak=0; game.patienceStreak=0; game.daySpending=0; game.miniGamesWon=0; game.walkCount=0; game.metroCount=0; game.kevinAvoidCount=0;

  renderState(); updateAchievementsUI(); showEvent();
  showNote('üóΩ','Bienvenue √† NYC‚Ä¶ bonne chance !');
}

function restartGame(){
  document.getElementById('gameOverScreen').classList.add('hidden');
  document.getElementById('gameScreen').classList.remove('hidden');
  document.getElementById('bottomNav').classList.remove('hidden');
  ['journalOverlay','achievementsOverlay','statsOverlay'].forEach(id=>document.getElementById(id).classList.remove('show'));
  startGame();
}

function checkGameOver(){
  const s=game.state;
  let r='';
  if(s.money<=0) r="üí∏ Fauch√©e ‚Äî impossible de continuer.";
  else if(s.energy<=0) r="üò¥ Effondr√©e de fatigue.";
  else if(s.hunger>=100) r="üçî Malaise de faim.";
  else if(s.patience<=0) r="üò° A explos√©‚Ä¶ (social KO).";
  else if(s.yamy<=0) r="üíî Le manque de Yamy est trop fort.";
  if(r){ endGame(r); return true; }
  return false;
}
function endGame(reason){
  document.getElementById('gameScreen').classList.add('hidden');
  document.getElementById('gameOverScreen').classList.remove('hidden');
  document.getElementById('bottomNav').classList.add('hidden');
  document.getElementById('gameOverReason').textContent = reason;

  document.getElementById('finalDays').textContent=game.state.day;
  document.getElementById('finalActions').textContent=game.state.actionCount;
  document.getElementById('finalMoney').textContent=fmt(game.state.money);
  document.getElementById('finalPhotos').textContent=game.state.photos;
  document.getElementById('finalAchievements').textContent=game.achievements.length;

  checkAchievements();
}
function victory(){
  checkAchievements();
  endGame(`üéâ VICTOIRE ! 5 jours √† NYC ‚Äî ${game.state.photos} photos et des souvenirs‚Ä¶`);
}

/* ================== WIRING ================== */
document.addEventListener('DOMContentLoaded', ()=>{
  // difficulty select
  document.querySelectorAll('#diffSelect .pill').forEach(btn=>{
    if(btn.dataset.diff===selectedDiff) btn.classList.add('active');
    btn.addEventListener('click', ()=>{
      document.querySelectorAll('#diffSelect .pill').forEach(x=>x.classList.remove('active'));
      btn.classList.add('active');
      selectedDiff = btn.dataset.diff;
      localStorage.setItem('msnyc_diff', selectedDiff);
    });
  });

  document.getElementById('startBtn').addEventListener('click', startGame);
  document.getElementById('restartBtn').addEventListener('click', restartGame);

  // bottom nav
  document.getElementById('journalBtn').addEventListener('click', ()=>toggleOverlay('journalOverlay'));
  document.getElementById('achievementsBtn').addEventListener('click', ()=>toggleOverlay('achievementsOverlay'));
  document.getElementById('statsBtn').addEventListener('click', ()=>toggleOverlay('statsOverlay'));
  document.getElementById('soundBtn').addEventListener('click', ()=>{
    soundEnabled = !soundEnabled;
    localStorage.setItem('msnyc_sound', JSON.stringify(soundEnabled));
    document.getElementById('soundBtn').textContent = soundEnabled? 'üîä':'üîá';
    if(soundEnabled) sounds.success();
  });
  document.getElementById('soundBtn').textContent = soundEnabled? 'üîä':'üîá';

  // overlay close buttons
  document.querySelectorAll('.overlay [data-close]').forEach(b=>b.addEventListener('click', (e)=> e.currentTarget.closest('.overlay').classList.remove('show')));

  // filters
  document.getElementById('filters').addEventListener('click', (e)=>{
    const btn = e.target.closest('.filter-btn'); if(!btn) return;
    document.querySelectorAll('.filter-btn').forEach(x=>x.classList.remove('active'));
    btn.classList.add('active'); game.currentFilter = btn.dataset.filter; updateJournalUI();
  });
});
</script>
</body>
</html>
